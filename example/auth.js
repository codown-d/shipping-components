var getAuth=function(){"use strict";var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};function n(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var e=function(){return(e=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function r(t,n,e,r){var o,i=arguments.length,c=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,e,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(n,e,c):o(n,e))||c);return i>3&&c&&Object.defineProperty(n,e,c),c}function o(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)}function i(t,n,e,r){return new(e||(e=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,a)}s((r=r.apply(t,n||[])).next())}))}function c(t,n){var e,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(t,c)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function a(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,i=e.call(t),c=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return c}function u(t,n,e){if(e||2===arguments.length)for(var r,o=0,i=n.length;o<i;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))}function l(t){return this instanceof l?(this.v=t,this):new l(t)}function f(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=e.apply(t,n||[]),i=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(t){o[t]&&(r[t]=function(n){return new Promise((function(e,r){i.push([t,n,e,r])>1||a(t,n)}))})}function a(t,n){try{!function(t){t.value instanceof l?Promise.resolve(t.value.v).then(s,u):f(i[0][2],t)}(o[t](n))}catch(t){f(i[0][3],t)}}function s(t){a("next",t)}function u(t){a("throw",t)}function f(t,n){t(n),i.shift(),i.length&&a(i[0][0],i[0][1])}}function h(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,e=t[Symbol.asyncIterator];return e?e.call(t):(t=a(t),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(e){n[e]=t[e]&&function(n){return new Promise((function(r,o){(function(t,n,e,r){Promise.resolve(r).then((function(n){t({value:n,done:e})}),n)})(r,o,(n=t[e](n)).done,n.value)}))}}}var p="__am_org_of_ac_:AC_ID",d="__am_conn_of_ac_:AC_ID",v="__am_company_of_ac_:AC_ID",g=function(){function t(){this.allEvents=new Map}return t.prototype.emit=function(t){for(var n=this,e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];setTimeout((function(){(n.allEvents.get(t)||[]).slice().map((function(t){t.apply(void 0,e)}))}))},t.prototype.on=function(t,n){var e=this.allEvents.get(t);e&&e.push(n)||this.allEvents.set(t,[n])},t.prototype.off=function(t,n){var e=this.allEvents.get(t);e&&e.splice(e.indexOf(n)>>>0,1)},t}(),y="/protocol/openid-connect/",m=function(t){return{authorize:t+y+"auth",token:t+y+"token",logout:t+y+"logout",checkSessionIframe:t+y+"login-status-iframe.html",thirdPartyCookiesIframe:t+y+"3p-cookies/step1.html",register:t+y+"registrations",userinfo:t+y+"userinfo"}},b=function(){var t=null,n=null;return{promise:new Promise((function(e,r){t=e,n=r})),resolve:t,reject:n}},w=function(t,n){var e=document.createElement("iframe");e.src=t,e.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),e.style.display="none",new URL(t).origin;var r=function(){window.removeEventListener("message",o,!1),document.body.removeChild(e)},o=function(t){n(t,{removeListener:r,iframe:e})};return window.addEventListener("message",o,!1),document.body.appendChild(e),{removeListener:r,iframe:e}},_="kc-callback-",k=function(){function t(){var t="kc-test";localStorage.setItem(t,"t"),localStorage.removeItem(t)}return t.prototype.get=function(n){if(!n)return null;var e=_+n;try{var r=localStorage.getItem(e);return r?(localStorage.removeItem(e),JSON.parse(r)):null}catch(t){return null}finally{t.clearExpired()}},t.prototype.add=function(n){t.clearExpired();var e=_+n.state;n.expires=(new Date).getTime()+36e5,localStorage.setItem(e,JSON.stringify(n))},t.clearExpired=function(){for(var t=(new Date).getTime(),n=0;n<localStorage.length;n++){var e=localStorage.key(n);if(e&&0==e.indexOf(_)){var r=localStorage.getItem(e);if(r)try{var o=JSON.parse(r).expires;(!o||o<t)&&localStorage.removeItem(e)}catch(t){localStorage.removeItem(e)}}}},t}(),O=function(){function t(){}return t.prototype.add=function(n){t.setCookie(_+n.state,JSON.stringify(n),t.cookieExpiration(60))},t.prototype.get=function(n){if(!n)return null;var e=t.getCookie(_+n);if(t.setCookie(_+n,"",t.cookieExpiration(-100)),!e)return null;try{return JSON.parse(e)}catch(t){return null}},t.cookieExpiration=function(t){var n=new Date;return n.setTime(n.getTime()+60*t*1e3),n},t.getCookie=function(t){for(var n=t+"=",e=document.cookie.split(";"),r=0;r<e.length;r++){for(var o=e[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return""},t.setCookie=function(t,n,e){document.cookie="".concat(t,"=").concat(n,";expires=").concat(e.toUTCString(),";")},t}(),S=function(){return function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}()||function(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(t){return!1}}()},C=function(){try{return new k}catch(t){}return new O}(),I=function(t){var n=z(t);if(!n)return null;var r=C.get(n.state);return r?e(e({},n),{valid:!0,redirectUri:r.redirectUri,nonce:r.nonce,storedNonce:r.nonce,prompt:r.prompt,pkceCodeVerifier:r.pkceCodeVerifier}):n},P=["error","error_description","error_uri","state","session_state","kc_action_status","code"],z=function(t){var n=new URL(t);if(!n.hash)return null;var r=new URLSearchParams(n.hash.replace(/^#(.+)/,"?$1")),o=P.reduce((function(t,n){var o,i=r.get(n);return i?(r.delete(n),e(e({},t),((o={})[n]=i,o))):t}),{}),i=decodeURIComponent(r.toString()).replace(/^(.+)$/,"#$1").replace(/^(.+)=$/,"$1");t=window.location.href;var c="".concat(t.replace(/^([^#]+).*$/,"$1")).concat(i);return(o.code||o.error)&&o.state?(o.newUrl=c,o):null},T=function(t){var n=URL.createObjectURL(new Blob),e=n.toString();URL.revokeObjectURL(n);var r=e.split(/[:\/]/g).pop();if(!r)throw new Error("Generate uuid error");return t?r.toLowerCase().replace(/-/g,""):r.toLowerCase()},A=function(t){return(n=t,e=(new TextEncoder).encode(n),window.crypto.subtle.digest("SHA-256",e)).then((function(t){return n=new Uint8Array(t),btoa(String.fromCharCode.apply(null,n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");var n}));var n,e};function E(t){var n=t.hostname,e=t.pathname;return"".concat(n).concat(e)}var R=function(){var t;return null===(t=null===window||void 0===window?void 0:window.datacatV2)||void 0===t?void 0:t.logout()},x=["utm_source","utm_medium","utm_content","utm_term","utm_campaign","utm_created_at","as_signup","as_source"];function L(t){try{return E(new URL(t))}catch(t){return}}var j=function(t,n){var e=new URL(t);return Object.entries(n).forEach((function(t){var n=t[0],r=t[1];return null!=r&&e.searchParams.append(n,String(r))})),e.toString()},U=function(t,n){return i(void 0,void 0,void 0,(function(){var r,o,i,a,s,u,l,f;return c(this,(function(c){switch(c.label){case 0:return r=(null==t?void 0:t.redirectUri)||window.location.href,o=new URLSearchParams(window.location.search),i=o.get("idp_hint")||(null==t?void 0:t.idpHint),a=o.get("login_hint")||(null==t?void 0:t.loginHint),r=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=new URL(t);return n.forEach((function(t){return r.searchParams.delete(t)})),r.href}(r,"login_hint","prompt","idp_hint"),s={state:T(),nonce:T(),prompt:(null==t?void 0:t.prompt)||"none",redirectUri:r,pkceCodeVerifier:"".concat(T(!0)).concat(T(!0)).concat(T(!0))},[4,A(s.pkceCodeVerifier)];case 1:return u=c.sent(),l="register"===(null==t?void 0:t.action)?n.register:n.authorize,f=j(l,e({client_id:t.clientId,state:s.state,response_mode:"fragment",response_type:"code",scope:"openid",nonce:s.nonce,prompt:null==t?void 0:t.prompt,max_age:null==t?void 0:t.maxAge,login_hint:a,kc_idp_hint:i,kc_action:"register"!==(null==t?void 0:t.action)?null==t?void 0:t.action:void 0,ui_locales:null==t?void 0:t.locale,code_challenge_method:"S256",code_challenge:u,redirect_uri:r,session_token:t.sessionToken,shopify_admin_redirection:o.get("shopify_admin_redirection"),shop:t.shop||o.get("shop"),host:t.host},function(){var t,n=new URLSearchParams(window.location.search);return x.reduce((function(t,r){var o,i;return e(e({},t),((o={})[r]=null!==(i=n.get(r))&&void 0!==i?i:void 0,o))}),{page_referrer:E(window.location),page_referrer_referrer:null!==(t=n.get("page_referrer"))&&void 0!==t?t:L(document.referrer)})}())),C.add(s),[2,f]}}))}))};function F(t){this.message=t}F.prototype=new Error,F.prototype.name="InvalidCharacterError";var N="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new F("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,r,o=0,i=0,c="";r=n.charAt(i++);~r&&(e=o%4?64*e+r:r,o++%4)?c+=String.fromCharCode(255&e>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return c};function M(t){var n=t.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(N(t).replace(/(.)/g,(function(t,n){var e=n.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e})))}(n)}catch(t){return N(n)}}function D(t){this.message=t}D.prototype=new Error,D.prototype.name="InvalidTokenError";var G,B=function(t){return function(t,n){if("string"!=typeof t)throw new D("Invalid token specified");var e=!0===(n=n||{}).header?0:1;try{return JSON.parse(M(t.split(".")[e]))}catch(t){throw new D("Invalid token specified: "+t.message)}}(t)},K=function(t,n){return i(void 0,void 0,void 0,(function(){var e,r,o,i,a,s,u,l,f;return c(this,(function(c){switch(c.label){case 0:return e=new URLSearchParams(n),r=(new Date).getTime(),[4,fetch(t,{method:"POST",credentials:"include",body:e.toString(),headers:{"Content-type":"application/x-www-form-urlencoded"}})];case 1:if(!(o=c.sent()).ok||o.status>=300)throw(i=new Error("Response failed")).status=o.status,i.name="Response failed",i;return[4,o.json()];case 2:return a=c.sent(),s=a.access_token,u=a.refresh_token,l=a.id_token,f=(r+(new Date).getTime())/2,[2,{accessToken:s,refreshToken:u,idToken:l,timeLocal:f}]}}))}))},q=function(t){function r(n){var e=t.call(this)||this;return e.config=n,e.timeSkew=3e4,e.tokenTimeoutHandle=null,e.loginIframeInstance=null,e.loginIframeEnable=!0,e.loginIframeInterval=5,e.silentCheckSsoFallback=!0,e.enableLogging=!1,e.logInfo=e.createLogger(console.info),e.logWarn=e.createLogger(console.warn),e.refreshingToken=null,e.state={authenticated:!1,refreshToken:null,refreshTokenParsed:null,token:null,tokenParsed:null,idToken:null,idTokenParsed:null},e.enableLogging=Boolean(n.enableLogging),e.refreshPromiseQueue=[],e.loginIframeCallbackList=[],e.loginIframeOrigin=null,e.endpoints=m("".concat(e.config.url,"/realms/").concat(encodeURIComponent(e.config.realm))),n.timeSkew&&(e.timeSkew=n.timeSkew),e.init(n).then((function(){e.handleInitializedCompleted()})).catch((function(t){e.handleInitializedFailed(t)})),e}return n(r,t),r.prototype.getConfig=function(){return this.config},r.prototype.handleInitializedCompleted=function(){this.emit("ready",this.state.authenticated)},r.prototype.handleInitializedFailed=function(t){this.emit("error",t)},r.prototype.getState=function(){return e({},this.state)},r.prototype.login=function(t){return i(this,void 0,void 0,(function(){var n;return c(this,(function(e){switch(e.label){case 0:return[4,this.createLoginURL(t)];case 1:return n=e.sent(),[2,new Promise((function(){window.location.replace(n)}))]}}))}))},r.prototype.logout=function(t){return i(this,void 0,void 0,(function(){var n,e;return c(this,(function(r){return n=(null==t?void 0:t.redirectUri)||this.config.redirectUri||window.location.href,e=j(this.endpoints.logout,{redirect_uri:n,post_logout_redirect_uri:n,client_id:this.config.clientId,id_token_hint:this.state.idToken}),window.location.replace(e),[2]}))}))},r.prototype.register=function(t){return i(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,this.createLoginURL(e(e({},t),{action:"register"}))];case 1:return n=r.sent(),window.location.replace(n),[2]}}))}))},r.prototype.keycloakCheck3pCookiesSupported=function(){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,(n=this.endpoints.thirdPartyCookiesIframe,new Promise((function(t){var e,r=w(n,(function(n){o.contentWindow===n.source&&(clearTimeout(e),["supported","unsupported"].includes(n.data)&&("unsupported"!==n.data?(i(),t(!0)):t(!1)))})),o=r.iframe,i=r.removeListener;e=setTimeout((function(){i(),t(!1)}),1e4)})))];case 1:return[2,t.sent()]}var n}))}))},r.prototype.isThirdPartyCookiesSupported=function(){return Boolean(this.config.thirdPartyCookiesSupported)},r.prototype.init=function(t){var n,e;return i(this,void 0,void 0,(function(){var r,o,i,a,s,u,l,f=this;return c(this,(function(c){switch(c.label){case 0:return[4,new Promise((function(t){var n=function(){"interactive"!==document.readyState&&"complete"!==document.readyState||(document.removeEventListener("readystatechange",n),t())};document.addEventListener("readystatechange",n),n()}))];case 1:return c.sent(),r=window.location.href,o=new URLSearchParams(window.location.search),void 0===t.thirdPartyCookiesSupported?[3,2]:(a=t.thirdPartyCookiesSupported,[3,4]);case 2:return[4,this.keycloakCheck3pCookiesSupported()];case 3:a=c.sent(),c.label=4;case 4:return i=a,this.config.thirdPartyCookiesSupported=Boolean(i),i||(this.loginIframeEnable=!1,this.silentCheckSsoFallback&&(this.config.silentCheckSsoRedirectUri=void 0)),void 0!==t.checkLoginIframeEnabled&&(this.loginIframeEnable=t.checkLoginIframeEnabled),(s=I(r))&&window.history.replaceState(window.history.state,"",s.newUrl),s&&"valid"in s?[4,this.processCallback(s)]:[3,6];case 5:return c.sent(),[3,36];case 6:return"login"!==o.get("prompt")?[3,7]:[2,new Promise((function(){f.login({prompt:"login"})}))];case 7:return this.config.token&&this.config.refreshToken?(this.setToken(this.config.token,this.config.refreshToken,this.config.idToken||null),this.loginIframeEnable?[4,this.setupCheckLoginIframe()]:[3,10]):[3,18];case 8:return c.sent(),[4,this.checkLoginIframe()];case 9:return c.sent()&&(this.emit("authSuccess"),this.scheduleCheckIframe()),[2];case 10:return c.trys.push([10,12,,17]),[4,this.updateToken(-1)];case 11:return c.sent(),this.emit("authSuccess"),[3,17];case 12:return u=c.sent(),this.emit("authError","Login failed",null!==(n=null==u?void 0:u.message)&&void 0!==n?n:void 0),this.loginIframeEnable?[4,this.setupCheckLoginIframe()]:[3,16];case 13:return c.sent(),[4,this.checkLoginIframe()];case 14:return c.sent()?[4,this.checkSsoSilently(!0)]:[3,16];case 15:c.sent(),c.label=16;case 16:return[3,17];case 17:return[3,36];case 18:if(!this.loginIframeEnable)return[3,30];c.label=19;case 19:return c.trys.push([19,28,,29]),[4,this.setupCheckLoginIframe()];case 20:return c.sent(),[4,this.checkLoginIframe()];case 21:return c.sent()?[3,26]:this.config.silentCheckSsoRedirectUri?[4,this.checkSsoSilently(!0)]:[3,23];case 22:return c.sent(),[3,25];case 23:return[4,this.login({prompt:"none"})];case 24:c.sent(),c.label=25;case 25:return[3,27];case 26:this.emit("authSuccess"),c.label=27;case 27:return[3,29];case 28:return l=c.sent(),this.emit("authError","Login check sso failed",null!==(e=null==l?void 0:l.message)&&void 0!==e?e:void 0),[3,29];case 29:return[3,36];case 30:return this.config.silentCheckSsoRedirectUri?[4,this.checkSsoSilently(!0)]:[3,32];case 31:return c.sent(),[3,35];case 32:return t.forceLogin?[4,this.login()]:[3,34];case 33:c.sent(),c.label=34;case 34:c.label=35;case 35:c.label=36;case 36:return[2]}}))}))},r.prototype.clearToken=function(){this.state.token&&(this.setToken(null,null,null),this.emit("authLogout"))},r.prototype.setToken=function(t,n,r,o){var i,c,a,s,u=this;if(this.tokenTimeoutHandle&&(clearTimeout(this.tokenTimeoutHandle),this.tokenTimeoutHandle=null),this.state=e(e({},this.state),{token:t,refreshToken:n,idToken:r}),this.state.refreshTokenParsed=n?B(n):null,this.state.idTokenParsed=r?B(r):null,t){this.state.tokenParsed=B(t),this.state.authenticated=!0;var l=null!==(c=null===(i=this.state.tokenParsed)||void 0===i?void 0:i.iat)&&void 0!==c?c:0,f=null!==(s=null===(a=this.state.tokenParsed)||void 0===a?void 0:a.exp)&&void 0!==s?s:0;if(o&&(this.timeSkew=Math.floor(o/1e3)-l),null!==this.timeSkew){this.logInfo("[KEYCLOAK] Estimated time difference between browser and server is "+this.timeSkew+" seconds");var h=1e3*(f-(new Date).getTime()/1e3+this.timeSkew);this.logInfo("[KEYCLOAK] Token expires in "+Math.round(h/1e3)+" s"),h<=0?this.emit("tokenExpired"):this.tokenTimeoutHandle=setTimeout((function(){u.emit("tokenExpired")}),h)}}else this.state.tokenParsed=null,this.state.authenticated=!1;this.emit("stateUpdated",this.state)},r.prototype.isTokenExpired=function(t){if(!this.state.tokenParsed||!this.state.refreshToken)throw new Error("Not authenticated");if(null===this.timeSkew)return this.logInfo("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var n=(this.state.tokenParsed.exp||0)-Math.ceil((new Date).getTime()/1e3)+this.timeSkew;if(t){if(isNaN(t))throw"Invalid minValidity";return n-t<0}return n<0},r.prototype.isRefreshTokenExpired=function(t){var n,e;if(!this.state.refreshTokenParsed||!this.state.refreshToken)throw new Error("Not authenticated");var r=((null===(e=null===(n=this.state)||void 0===n?void 0:n.refreshTokenParsed)||void 0===e?void 0:e.exp)||0)-Math.ceil((new Date).getTime()/1e3)+this.timeSkew;return t?r-t<0:r<0},r.prototype.updateToken=function(t){return void 0===t&&(t=5),i(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:if(!this.state.refreshToken)throw new Error("Missing refresh token");return this.loginIframeEnable?[4,this.checkLoginIframe()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2,this.refreshToken(t)]}}))}))},r.prototype.refreshToken=function(t){return i(this,void 0,void 0,(function(){var n,e=this;return c(this,(function(r){switch(r.label){case 0:return n=b(),[4,function(){return i(e,void 0,void 0,(function(){var e,r,o,i,a,s,u,l,f,h;return c(this,(function(c){switch(c.label){case 0:return e=!1,-1==t?(this.logInfo("[KEYCLOAK] Refreshing token: forced refresh"),e=!0):this.state.tokenParsed&&!this.isTokenExpired(t)||(this.logInfo("[KEYCLOAK] Refreshing token: token expired"),e=!0),e?[3,1]:(n.resolve(!1),[3,5]);case 1:if(this.refreshPromiseQueue.push(n),1!==this.refreshPromiseQueue.length)return[3,5];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,K(this.endpoints.token,{client_id:this.config.clientId,grant_type:"refresh_token",refresh_token:null!==(h=null===(f=this.state)||void 0===f?void 0:f.refreshToken)&&void 0!==h?h:""})];case 3:for(r=c.sent(),o=r.accessToken,i=r.refreshToken,a=r.idToken,s=r.timeLocal,this.setToken(o,i,a,s),this.logInfo("[KEYCLOAK] Token refreshed"),l=this.refreshPromiseQueue.pop();Boolean(l);l=this.refreshPromiseQueue.pop())null==l||l.resolve(!0);return[3,5];case 4:for(400===(u=c.sent()).status&&this.clearToken(),n.reject(u),l=this.refreshPromiseQueue.pop();Boolean(l);l=this.refreshPromiseQueue.pop())null==l||l.reject(u);return[3,5];case 5:return[2]}}))}))}()];case 1:return r.sent(),[2,n.promise]}}))}))},r.prototype.createLoginURL=function(t){return i(this,void 0,void 0,(function(){return c(this,(function(n){return[2,U(e(e({},t),{clientId:this.config.clientId,redirectUri:(null==t?void 0:t.redirectUri)||this.config.redirectUri}),this.endpoints)]}))}))},r.prototype.checkSsoSilently=function(t){return i(this,void 0,void 0,(function(){var t,n=this;return c(this,(function(e){switch(e.label){case 0:return[4,this.createLoginURL({prompt:"none",redirectUri:this.config.silentCheckSsoRedirectUri})];case 1:return t=e.sent(),[2,new Promise((function(e,r){var o=w(t,(function(t,a){var s=a.removeListener;return i(n,void 0,void 0,(function(){var n,i;return c(this,(function(c){switch(c.label){case 0:if(t.origin!==window.location.origin||o.contentWindow!==t.source)return[2];if(!(n=I(t.data))||!("valid"in n))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.processCallback(n)];case 2:return c.sent(),e(),[3,4];case 3:return i=c.sent(),console.error(i),r(),[3,4];case 4:return[3,6];case 5:r(),c.label=6;case 6:return s(),[2]}}))}))})).iframe}))]}}))}))},r.prototype.processCallback=function(t){var n,e,r;return i(this,void 0,void 0,(function(){var o,i,a,s,u,l,f,h,p,d,v,g;return c(this,(function(c){switch(c.label){case 0:if(o=t.code,i=t.error,a=t.prompt,s=t.storedNonce,u=t.error_description,l=t.redirectUri,f=t.pkceCodeVerifier,i){if("none"!==a)throw this.emit("authError",i,u),new Error(i);return[2]}return o?[4,K(this.endpoints.token,{code:o,grant_type:"authorization_code",client_id:this.config.clientId,redirect_uri:l,code_verifier:f})]:[3,2];case 1:if(h=c.sent(),p=h.accessToken,d=h.refreshToken,v=h.idToken,g=h.timeLocal,this.setToken(p,d,v,g),[null===(n=this.state.tokenParsed)||void 0===n?void 0:n.nonce,null===(e=this.state.refreshTokenParsed)||void 0===e?void 0:e.nonce,null===(r=this.state.idTokenParsed)||void 0===r?void 0:r.nonce].some((function(t){return t!==s})))throw this.clearToken(),new Error("Invalid nonce");this.scheduleCheckIframe(),c.label=2;case 2:return[2]}}))}))},r.prototype.scheduleCheckIframe=function(){var t=this;this.loginIframeEnable&&this.state.token&&setTimeout((function(){t.checkLoginIframe().then((function(n){n&&t.scheduleCheckIframe()}))}),1e3*this.loginIframeInterval)},r.prototype.checkLoginIframe=function(){var t,n,e=b();if(this.loginIframeInstance){this.loginIframeCallbackList.push(e);var r=new URL(this.endpoints.checkSessionIframe).origin,o=null===(t=this.state.tokenParsed)||void 0===t?void 0:t.session_state,i="".concat(this.config.clientId," ").concat(o||"");1===this.loginIframeCallbackList.length&&(null===(n=this.loginIframeInstance.contentWindow)||void 0===n||n.postMessage(i,r))}else e.resolve(!0);return e.promise},r.prototype.setupCheckLoginIframe=function(){return i(this,void 0,void 0,(function(){var t,n,e,r,o=this;return c(this,(function(i){return t=b(),this.loginIframeEnable?this.loginIframeInstance?(t.resolve(!0),[2,t.promise]):(n=document.createElement("iframe"),this.loginIframeInstance=n,n.onload=function(){var n=o.endpoints.authorize;o.loginIframeOrigin=new URL(n).origin,t.resolve(!0)},e=this.endpoints.checkSessionIframe,n.setAttribute("src",e),n.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),n.setAttribute("title","keycloak-session-iframe"),n.style.display="none",document.body.appendChild(n),r=function(t){var n;if(t.origin===o.loginIframeOrigin&&(null===(n=o.loginIframeInstance)||void 0===n?void 0:n.contentWindow)===t.source&&("unchanged"==t.data||"changed"==t.data||"error"==t.data)){"unchanged"!=t.data&&o.clearToken();for(var e=o.loginIframeCallbackList.splice(0,o.loginIframeCallbackList.length),r=e.length-1;r>=0;--r){var i=e[r];"error"==t.data?i.reject(t.data):i.resolve("unchanged"===t.data)}}},window.addEventListener("message",r,!1),[2,t.promise]):(t.resolve(!0),[2,t.promise])}))}))},r.prototype.createLogger=function(t){var n=this;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.enableLogging&&t.apply(console,Array.prototype.slice.call(e))}},r}(g),H=null,Y=function(){return H};/^release-/.test("testing"),function(t){t.SHOPIFY="shopify"}(G||(G={}));var $,W=function(t){function r(n){var e=t.call(this,n)||this;return e.config=n,e.shopifyInstance=Y(),e}return n(r,t),r.prototype.createLoginURL=function(t){return i(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,i(void 0,void 0,void 0,(function(){var t,n,e,r,o,i,a,s;return c(this,(function(c){switch(c.label){case 0:return H?(t=new URLSearchParams(window.location.search),[4,H.getShopifySessionToken()]):[2];case 1:return n=c.sent(),e=null!==(o=t.get("shop"))&&void 0!==o?o:null===(i=null==H?void 0:H.getShopifyAppBridgeConfig())||void 0===i?void 0:i.shop,r=null!==(a=t.get("host"))&&void 0!==a?a:null===(s=null==H?void 0:H.getShopifyAppBridgeConfig())||void 0===s?void 0:s.host,[2,{sessionToken:n,shop:e,host:r}]}}))}))];case 1:return n=r.sent(),[2,U(e(e(e({},t),{clientId:this.config.clientId,redirectUri:(null==t?void 0:t.redirectUri)||this.config.redirectUri,prompt:"login"}),n),this.endpoints)]}}))}))},r.prototype.processCallback=function(n){return i(this,void 0,void 0,(function(){var e,r,o,i=this;return c(this,(function(c){switch(c.label){case 0:return"login_required"===n.error?[3,2]:[4,t.prototype.processCallback.call(this,n)];case 1:return[2,c.sent()];case 2:return e=new URLSearchParams(window.location.search),a=G.SHOPIFY,s=this.config.clientId,r="".concat("https://accounts.aftership.io/auth","/realms/business/integrations/oauth/").concat(a,"/").concat(s),o="".concat(r,"?shop=").concat(e.get("shop")),[4,new Promise((function(){var t;null===(t=i.shopifyInstance)||void 0===t||t.topLevelRedirect(o)}))];case 3:return[2,c.sent()]}var a,s}))}))},r.prototype.login=function(n){return i(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.loginIframeEnable?[4,this.checkSsoSilently()]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.prototype.login.call(this,n)];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))},r.prototype.checkLoginIframe=function(){return i(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return this.state.authenticated||!this.loginIframeEnable?[3,1]:[2,Promise.resolve(!1)];case 1:return[4,t.prototype.checkLoginIframe.call(this)];case 2:return[2,n.sent()]}}))}))},r.prototype.keycloakCheck3pCookiesSupported=function(){return i(this,void 0,void 0,(function(){var n=this;return c(this,(function(e){switch(e.label){case 0:return S()?[3,2]:[4,new Promise((function(){n.emit("thirdPartyCookiesUnsupported")}))];case 1:return[2,e.sent()];case 2:return[2,t.prototype.keycloakCheck3pCookiesSupported.call(this)]}}))}))},r}(q),Z=function(t){function r(n){var e=t.call(this)||this;e.config=n,e.tokenStorageKeys=["k","ik","rk"],e.keycloakByClient=new Map,e.initialized=!1,e.tokenResolvers=[],e.initialResolvers=[],e.loginFlag=!1,e.logoutFlag=!1,e.on("token",(function(){for(;e.tokenResolvers.length;){var t=e.tokenResolvers.pop();t&&t()}})),e.on("init",(function(){for(;e.initialResolvers.length;){var t=e.initialResolvers.pop();t&&t()}}));var r=e.createKeycloak(n);return r.on("error",(function(t){return e.emit("error",t)})),r.on("tokenExpired",(function(){e.updateKeycloakToken().catch((function(t){return e.emit("error",t)}))})),r.on("thirdPartyCookiesUnsupported",(function(){return e.emit("thirdPartyCookiesUnsupported")})),e._keycloak=r,e}return n(r,t),Object.defineProperty(r.prototype,"token",{get:function(){return this.keycloak.getState().token},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tokenParsed",{get:function(){return this.keycloak.getState().tokenParsed},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"keycloak",{get:function(){return this._keycloak},enumerable:!1,configurable:!0}),r.prototype.onConfigChange=function(t){this.config=t,this._keycloak=this.getOrCreateKeycloakByClient(t)},r.prototype.getOrCreateKeycloakByClient=function(t){var n=this.keycloak.getConfig().clientId,r=t.clientId;return n===r?this.keycloak:this.keycloakByClient.get(r)||this.createKeycloak(e(e({},t),{thirdPartyCookiesSupported:this.keycloak.isThirdPartyCookiesSupported(),checkLoginIframeEnabled:!1}))},r.prototype.createKeycloak=function(t){var n=this;this.initialized=!1;var e=function(t,n){switch(t){case"shopify":return new W(n);case"default":default:return new q(n)}}(function(){switch(!0){case Boolean(Y()):return"shopify";default:return"default"}}(),{url:"business"===t.realm?"https://accounts.aftership.io/auth":"https://accounts.aftership.me/auth",realm:t.realm,clientId:t.clientId,timeSkew:3e4,silentCheckSsoRedirectUri:t.silentCheckSsoRedirectUri||"".concat(window.origin,"/auth/silent-callback.html"),checkLoginIframeInterval:6e5,enableLogging:!1,forceLogin:t.forceLogin,thirdPartyCookiesSupported:t.thirdPartyCookiesSupported,checkLoginIframeEnabled:t.checkLoginIframeEnabled});return this.keycloakByClient.set(t.clientId,e),e.on("ready",(function(e){e?n.updateToken():(t.forceLogin&&n.login(t.loginRedirectUri),n.initialized=!0,n.emit("init"))})),e},r.prototype.updateKeycloakToken=function(){var t=this;return new Promise((function(n,e){t.keycloak.updateToken(5).then((function(e){e?(t.updateToken(),n(e)):n(e)})).catch((function(n){t.login(t.config.loginRedirectUri),e(n)}))}))},r.prototype.updateToken=function(){var t=this.keycloak.getState();this.initialized=!0,this.emit("init"),this.emit("token",{token:t.token,tokenParsed:t.tokenParsed})},r.prototype.getUserInfo=function(){return i(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){return this.initialized?[2,Promise.resolve(this.tokenParsed)]:[2,new Promise((function(n){t.tokenResolvers.push(n)})).then((function(){return t.tokenParsed}))]}))}))},r.prototype.getAuthorization=function(){var t;return i(this,void 0,void 0,(function(){var n=this;return c(this,(function(e){return this.initialized?[2,Promise.resolve("".concat(null===(t=this.tokenParsed)||void 0===t?void 0:t.typ," ").concat(this.token))]:[2,new Promise((function(t){n.tokenResolvers.push(t)})).then((function(){var t;return"".concat(null===(t=n.tokenParsed)||void 0===t?void 0:t.typ," ").concat(n.token)}))]}))}))},r.prototype.removeStorageTokens=function(){this.tokenStorageKeys.forEach((function(t){var n="__am_t_:KEY".replace(":KEY",t);window.localStorage.removeItem(n)}))},r.attachHashToUrl=function(t){if(t){if(!window.location.hash)return t;var n=new URL(t);return n.hash=window.location.hash,n.toString()}},r.prototype.login=function(t){var n=this;if(this.loginFlag)return Promise.resolve();this.loginFlag=!0;var e=function(){n.keycloak.login({redirectUri:r.attachHashToUrl(t)})};return this.initialized?(e(),Promise.resolve()):new Promise((function(t){n.initialResolvers.push(t)})).then(e)},r.prototype.logout=function(t){var n=this;if(this.logoutFlag)return Promise.resolve();this.logoutFlag=!0;var e=function(){R(),n.keycloak.logout({redirectUri:r.attachHashToUrl(t)})};return this.initialized?(e(),Promise.resolve()):new Promise((function(t){n.initialResolvers.push(t)})).then(e)},r.prototype.register=function(t){var n=this,e=function(){n.keycloak.register({redirectUri:r.attachHashToUrl(t)})};return this.initialized?(e(),Promise.resolve()):new Promise((function(t){n.initialResolvers.push(t)})).then(e)},r}(g),V="organization_id",J="company_id",Q="connection_id",X="organization-not-paying",tt="shop";!function(t){t.ORGANIZATION="organization",t.BUSINESS="business"}($||($={}));var nt="object"==typeof global&&global&&global.Object===Object&&global,et="object"==typeof self&&self&&self.Object===Object&&self,rt=nt||et||Function("return this")(),ot=rt.Symbol,it=Object.prototype,ct=it.hasOwnProperty,at=it.toString,st=ot?ot.toStringTag:void 0;var ut=Object.prototype.toString;var lt=ot?ot.toStringTag:void 0;function ft(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":lt&&lt in Object(t)?function(t){var n=ct.call(t,st),e=t[st];try{t[st]=void 0;var r=!0}catch(t){}var o=at.call(t);return r&&(n?t[st]=e:delete t[st]),o}(t):function(t){return ut.call(t)}(t)}function ht(t){return null!=t&&"object"==typeof t}function pt(t){return"symbol"==typeof t||ht(t)&&"[object Symbol]"==ft(t)}var dt=Array.isArray,vt=ot?ot.prototype:void 0,gt=vt?vt.toString:void 0;function yt(t){if("string"==typeof t)return t;if(dt(t))return function(t,n){for(var e=-1,r=null==t?0:t.length,o=Array(r);++e<r;)o[e]=n(t[e],e,t);return o}(t,yt)+"";if(pt(t))return gt?gt.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n}function mt(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)}function bt(t){return t}function wt(t){if(!mt(t))return!1;var n=ft(t);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n}var _t,kt=rt["__core-js_shared__"],Ot=(_t=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||""))?"Symbol(src)_1."+_t:"";var St=Function.prototype.toString;function Ct(t){if(null!=t){try{return St.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var It=/^\[object .+?Constructor\]$/,Pt=Function.prototype,zt=Object.prototype,Tt=Pt.toString,At=zt.hasOwnProperty,Et=RegExp("^"+Tt.call(At).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Rt(t){return!(!mt(t)||(n=t,Ot&&Ot in n))&&(wt(t)?Et:It).test(Ct(t));var n}function xt(t,n){var e=function(t,n){return null==t?void 0:t[n]}(t,n);return Rt(e)?e:void 0}var Lt=xt(rt,"WeakMap");function jt(t){return t!=t}function Ut(t,n){return!!(null==t?0:t.length)&&function(t,n,e){return n==n?function(t,n,e){for(var r=e-1,o=t.length;++r<o;)if(t[r]===n)return r;return-1}(t,n,e):function(t,n,e,r){for(var o=t.length,i=e+(r?1:-1);r?i--:++i<o;)if(n(t[i],i,t))return i;return-1}(t,jt,e)}(t,n,0)>-1}var Ft=/^(?:0|[1-9]\d*)$/;function Nt(t,n){var e=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==e||"symbol"!=e&&Ft.test(t))&&t>-1&&t%1==0&&t<n}function Mt(t,n){return t===n||t!=t&&n!=n}function Dt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var Gt=Object.prototype;function Bt(t){return ht(t)&&"[object Arguments]"==ft(t)}var Kt=Object.prototype,qt=Kt.hasOwnProperty,Ht=Kt.propertyIsEnumerable,Yt=Bt(function(){return arguments}())?Bt:function(t){return ht(t)&&qt.call(t,"callee")&&!Ht.call(t,"callee")};var $t="object"==typeof exports&&exports&&!exports.nodeType&&exports,Wt=$t&&"object"==typeof module&&module&&!module.nodeType&&module,Zt=Wt&&Wt.exports===$t?rt.Buffer:void 0,Vt=(Zt?Zt.isBuffer:void 0)||function(){return!1},Jt={};Jt["[object Float32Array]"]=Jt["[object Float64Array]"]=Jt["[object Int8Array]"]=Jt["[object Int16Array]"]=Jt["[object Int32Array]"]=Jt["[object Uint8Array]"]=Jt["[object Uint8ClampedArray]"]=Jt["[object Uint16Array]"]=Jt["[object Uint32Array]"]=!0,Jt["[object Arguments]"]=Jt["[object Array]"]=Jt["[object ArrayBuffer]"]=Jt["[object Boolean]"]=Jt["[object DataView]"]=Jt["[object Date]"]=Jt["[object Error]"]=Jt["[object Function]"]=Jt["[object Map]"]=Jt["[object Number]"]=Jt["[object Object]"]=Jt["[object RegExp]"]=Jt["[object Set]"]=Jt["[object String]"]=Jt["[object WeakMap]"]=!1;var Qt,Xt="object"==typeof exports&&exports&&!exports.nodeType&&exports,tn=Xt&&"object"==typeof module&&module&&!module.nodeType&&module,nn=tn&&tn.exports===Xt&&nt.process,en=function(){try{var t=tn&&tn.require&&tn.require("util").types;return t||nn&&nn.binding&&nn.binding("util")}catch(t){}}(),rn=en&&en.isTypedArray,on=rn?(Qt=rn,function(t){return Qt(t)}):function(t){return ht(t)&&Dt(t.length)&&!!Jt[ft(t)]},cn=Object.prototype.hasOwnProperty;function an(t,n){var e=dt(t),r=!e&&Yt(t),o=!e&&!r&&Vt(t),i=!e&&!r&&!o&&on(t),c=e||r||o||i,a=c?function(t,n){for(var e=-1,r=Array(t);++e<t;)r[e]=n(e);return r}(t.length,String):[],s=a.length;for(var u in t)!n&&!cn.call(t,u)||c&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Nt(u,s))||a.push(u);return a}var sn=function(t,n){return function(e){return t(n(e))}}(Object.keys,Object),un=Object.prototype.hasOwnProperty;function ln(t){if(e=(n=t)&&n.constructor,n!==("function"==typeof e&&e.prototype||Gt))return sn(t);var n,e,r=[];for(var o in Object(t))un.call(t,o)&&"constructor"!=o&&r.push(o);return r}function fn(t){return null!=(n=t)&&Dt(n.length)&&!wt(n)?an(t):ln(t);var n}var hn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pn=/^\w*$/;function dn(t,n){if(dt(t))return!1;var e=typeof t;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!pt(t))||(pn.test(t)||!hn.test(t)||null!=n&&t in Object(n))}var vn=xt(Object,"create");var gn=Object.prototype.hasOwnProperty;var yn=Object.prototype.hasOwnProperty;function mn(t){var n=-1,e=null==t?0:t.length;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function bn(t,n){for(var e=t.length;e--;)if(Mt(t[e][0],n))return e;return-1}mn.prototype.clear=function(){this.__data__=vn?vn(null):{},this.size=0},mn.prototype.delete=function(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n},mn.prototype.get=function(t){var n=this.__data__;if(vn){var e=n[t];return"__lodash_hash_undefined__"===e?void 0:e}return gn.call(n,t)?n[t]:void 0},mn.prototype.has=function(t){var n=this.__data__;return vn?void 0!==n[t]:yn.call(n,t)},mn.prototype.set=function(t,n){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=vn&&void 0===n?"__lodash_hash_undefined__":n,this};var wn=Array.prototype.splice;function _n(t){var n=-1,e=null==t?0:t.length;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}_n.prototype.clear=function(){this.__data__=[],this.size=0},_n.prototype.delete=function(t){var n=this.__data__,e=bn(n,t);return!(e<0)&&(e==n.length-1?n.pop():wn.call(n,e,1),--this.size,!0)},_n.prototype.get=function(t){var n=this.__data__,e=bn(n,t);return e<0?void 0:n[e][1]},_n.prototype.has=function(t){return bn(this.__data__,t)>-1},_n.prototype.set=function(t,n){var e=this.__data__,r=bn(e,t);return r<0?(++this.size,e.push([t,n])):e[r][1]=n,this};var kn=xt(rt,"Map");function On(t,n){var e,r,o=t.__data__;return("string"==(r=typeof(e=n))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==e:null===e)?o["string"==typeof n?"string":"hash"]:o.map}function Sn(t){var n=-1,e=null==t?0:t.length;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}Sn.prototype.clear=function(){this.size=0,this.__data__={hash:new mn,map:new(kn||_n),string:new mn}},Sn.prototype.delete=function(t){var n=On(this,t).delete(t);return this.size-=n?1:0,n},Sn.prototype.get=function(t){return On(this,t).get(t)},Sn.prototype.has=function(t){return On(this,t).has(t)},Sn.prototype.set=function(t,n){var e=On(this,t),r=e.size;return e.set(t,n),this.size+=e.size==r?0:1,this};function Cn(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new TypeError("Expected a function");var e=function(){var r=arguments,o=n?n.apply(this,r):r[0],i=e.cache;if(i.has(o))return i.get(o);var c=t.apply(this,r);return e.cache=i.set(o,c)||i,c};return e.cache=new(Cn.Cache||Sn),e}Cn.Cache=Sn;var In=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pn=/\\(\\)?/g,zn=function(t){var n=Cn(t,(function(t){return 500===e.size&&e.clear(),t})),e=n.cache;return n}((function(t){var n=[];return 46===t.charCodeAt(0)&&n.push(""),t.replace(In,(function(t,e,r,o){n.push(r?o.replace(Pn,"$1"):e||t)})),n}));function Tn(t,n){return dt(t)?t:dn(t,n)?[t]:zn(function(t){return null==t?"":yt(t)}(t))}function An(t){if("string"==typeof t||pt(t))return t;var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n}function En(t,n){for(var e=0,r=(n=Tn(n,t)).length;null!=t&&e<r;)t=t[An(n[e++])];return e&&e==r?t:void 0}function Rn(t){var n=this.__data__=new _n(t);this.size=n.size}Rn.prototype.clear=function(){this.__data__=new _n,this.size=0},Rn.prototype.delete=function(t){var n=this.__data__,e=n.delete(t);return this.size=n.size,e},Rn.prototype.get=function(t){return this.__data__.get(t)},Rn.prototype.has=function(t){return this.__data__.has(t)},Rn.prototype.set=function(t,n){var e=this.__data__;if(e instanceof _n){var r=e.__data__;if(!kn||r.length<199)return r.push([t,n]),this.size=++e.size,this;e=this.__data__=new Sn(r)}return e.set(t,n),this.size=e.size,this};var xn=Object.prototype.propertyIsEnumerable,Ln=Object.getOwnPropertySymbols,jn=Ln?function(t){return null==t?[]:(t=Object(t),function(t,n){for(var e=-1,r=null==t?0:t.length,o=0,i=[];++e<r;){var c=t[e];n(c,e,t)&&(i[o++]=c)}return i}(Ln(t),(function(n){return xn.call(t,n)})))}:function(){return[]};function Un(t){return function(t,n,e){var r=n(t);return dt(t)?r:function(t,n){for(var e=-1,r=n.length,o=t.length;++e<r;)t[o+e]=n[e];return t}(r,e(t))}(t,fn,jn)}var Fn=xt(rt,"DataView"),Nn=xt(rt,"Promise"),Mn=xt(rt,"Set"),Dn="[object Map]",Gn="[object Promise]",Bn="[object Set]",Kn="[object WeakMap]",qn="[object DataView]",Hn=Ct(Fn),Yn=Ct(kn),$n=Ct(Nn),Wn=Ct(Mn),Zn=Ct(Lt),Vn=ft;(Fn&&Vn(new Fn(new ArrayBuffer(1)))!=qn||kn&&Vn(new kn)!=Dn||Nn&&Vn(Nn.resolve())!=Gn||Mn&&Vn(new Mn)!=Bn||Lt&&Vn(new Lt)!=Kn)&&(Vn=function(t){var n=ft(t),e="[object Object]"==n?t.constructor:void 0,r=e?Ct(e):"";if(r)switch(r){case Hn:return qn;case Yn:return Dn;case $n:return Gn;case Wn:return Bn;case Zn:return Kn}return n});var Jn=Vn,Qn=rt.Uint8Array;function Xn(t){var n=-1,e=null==t?0:t.length;for(this.__data__=new Sn;++n<e;)this.add(t[n])}function te(t,n){for(var e=-1,r=null==t?0:t.length;++e<r;)if(n(t[e],e,t))return!0;return!1}function ne(t,n){return t.has(n)}Xn.prototype.add=Xn.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Xn.prototype.has=function(t){return this.__data__.has(t)};function ee(t,n,e,r,o,i){var c=1&e,a=t.length,s=n.length;if(a!=s&&!(c&&s>a))return!1;var u=i.get(t),l=i.get(n);if(u&&l)return u==n&&l==t;var f=-1,h=!0,p=2&e?new Xn:void 0;for(i.set(t,n),i.set(n,t);++f<a;){var d=t[f],v=n[f];if(r)var g=c?r(v,d,f,n,t,i):r(d,v,f,t,n,i);if(void 0!==g){if(g)continue;h=!1;break}if(p){if(!te(n,(function(t,n){if(!ne(p,n)&&(d===t||o(d,t,e,r,i)))return p.push(n)}))){h=!1;break}}else if(d!==v&&!o(d,v,e,r,i)){h=!1;break}}return i.delete(t),i.delete(n),h}function re(t){var n=-1,e=Array(t.size);return t.forEach((function(t,r){e[++n]=[r,t]})),e}function oe(t){var n=-1,e=Array(t.size);return t.forEach((function(t){e[++n]=t})),e}var ie=ot?ot.prototype:void 0,ce=ie?ie.valueOf:void 0;var ae=Object.prototype.hasOwnProperty;var se="[object Arguments]",ue="[object Array]",le="[object Object]",fe=Object.prototype.hasOwnProperty;function he(t,n,e,r,o,i){var c=dt(t),a=dt(n),s=c?ue:Jn(t),u=a?ue:Jn(n),l=(s=s==se?le:s)==le,f=(u=u==se?le:u)==le,h=s==u;if(h&&Vt(t)){if(!Vt(n))return!1;c=!0,l=!1}if(h&&!l)return i||(i=new Rn),c||on(t)?ee(t,n,e,r,o,i):function(t,n,e,r,o,i,c){switch(e){case"[object DataView]":if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=n.byteLength||!i(new Qn(t),new Qn(n)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Mt(+t,+n);case"[object Error]":return t.name==n.name&&t.message==n.message;case"[object RegExp]":case"[object String]":return t==n+"";case"[object Map]":var a=re;case"[object Set]":var s=1&r;if(a||(a=oe),t.size!=n.size&&!s)return!1;var u=c.get(t);if(u)return u==n;r|=2,c.set(t,n);var l=ee(a(t),a(n),r,o,i,c);return c.delete(t),l;case"[object Symbol]":if(ce)return ce.call(t)==ce.call(n)}return!1}(t,n,s,e,r,o,i);if(!(1&e)){var p=l&&fe.call(t,"__wrapped__"),d=f&&fe.call(n,"__wrapped__");if(p||d){var v=p?t.value():t,g=d?n.value():n;return i||(i=new Rn),o(v,g,e,r,i)}}return!!h&&(i||(i=new Rn),function(t,n,e,r,o,i){var c=1&e,a=Un(t),s=a.length;if(s!=Un(n).length&&!c)return!1;for(var u=s;u--;){var l=a[u];if(!(c?l in n:ae.call(n,l)))return!1}var f=i.get(t),h=i.get(n);if(f&&h)return f==n&&h==t;var p=!0;i.set(t,n),i.set(n,t);for(var d=c;++u<s;){var v=t[l=a[u]],g=n[l];if(r)var y=c?r(g,v,l,n,t,i):r(v,g,l,t,n,i);if(!(void 0===y?v===g||o(v,g,e,r,i):y)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var m=t.constructor,b=n.constructor;m==b||!("constructor"in t)||!("constructor"in n)||"function"==typeof m&&m instanceof m&&"function"==typeof b&&b instanceof b||(p=!1)}return i.delete(t),i.delete(n),p}(t,n,e,r,o,i))}function pe(t,n,e,r,o){return t===n||(null==t||null==n||!ht(t)&&!ht(n)?t!=t&&n!=n:he(t,n,e,r,pe,o))}function de(t){return t==t&&!mt(t)}function ve(t,n){return function(e){return null!=e&&(e[t]===n&&(void 0!==n||t in Object(e)))}}function ge(t){var n=function(t){for(var n=fn(t),e=n.length;e--;){var r=n[e],o=t[r];n[e]=[r,o,de(o)]}return n}(t);return 1==n.length&&n[0][2]?ve(n[0][0],n[0][1]):function(e){return e===t||function(t,n,e,r){var o=e.length,i=o,c=!r;if(null==t)return!i;for(t=Object(t);o--;){var a=e[o];if(c&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var s=(a=e[o])[0],u=t[s],l=a[1];if(c&&a[2]){if(void 0===u&&!(s in t))return!1}else{var f=new Rn;if(r)var h=r(u,l,s,t,n,f);if(!(void 0===h?pe(l,u,3,r,f):h))return!1}}return!0}(e,t,n)}}function ye(t,n){return null!=t&&n in Object(t)}function me(t,n){return null!=t&&function(t,n,e){for(var r=-1,o=(n=Tn(n,t)).length,i=!1;++r<o;){var c=An(n[r]);if(!(i=null!=t&&e(t,c)))break;t=t[c]}return i||++r!=o?i:!!(o=null==t?0:t.length)&&Dt(o)&&Nt(c,o)&&(dt(t)||Yt(t))}(t,n,ye)}function be(t,n){return dn(t)&&de(n)?ve(An(t),n):function(e){var r=function(t,n,e){var r=null==t?void 0:En(t,n);return void 0===r?e:r}(e,t);return void 0===r&&r===n?me(e,t):pe(n,r,3)}}function we(t){return dn(t)?(n=An(t),function(t){return null==t?void 0:t[n]}):function(t){return function(n){return En(n,t)}}(t);var n}function _e(t,n,e){for(var r=-1,o=null==t?0:t.length;++r<o;)if(e(n,t[r]))return!0;return!1}var ke=Mn&&1/oe(new Mn([,-0]))[1]==1/0?function(t){return new Mn(t)}:function(){};function Oe(t,n){return t&&t.length?function(t,n,e){var r=-1,o=Ut,i=t.length,c=!0,a=[],s=a;if(e)c=!1,o=_e;else if(i>=200){var u=n?null:ke(t);if(u)return oe(u);c=!1,o=ne,s=new Xn}else s=n?[]:a;t:for(;++r<i;){var l=t[r],f=n?n(l):l;if(l=e||0!==l?l:0,c&&f==f){for(var h=s.length;h--;)if(s[h]===f)continue t;n&&s.push(f),a.push(l)}else o(s,f,e)||(s!==a&&s.push(f),a.push(l))}return a}(t,"function"==typeof(e=n)?e:null==e?bt:"object"==typeof e?dt(e)?be(e[0],e[1]):ge(e):we(e)):[];var e}function Se(t){return"function"==typeof t}function Ce(t){var n=t((function(t){Error.call(t),t.stack=(new Error).stack}));return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ie=Ce((function(t){return function(n){t(this),this.message=n?n.length+" errors occurred during unsubscription:\n"+n.map((function(t,n){return n+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=n}}));function Pe(t,n){if(t){var e=t.indexOf(n);0<=e&&t.splice(e,1)}}var ze=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var n;return t.prototype.unsubscribe=function(){var t,n,e,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var c=a(i),l=c.next();!l.done;l=c.next()){l.value.remove(this)}}catch(n){t={error:n}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}else i.remove(this);var f=this.initialTeardown;if(Se(f))try{f()}catch(t){o=t instanceof Ie?t.errors:[t]}var h=this._teardowns;if(h){this._teardowns=null;try{for(var p=a(h),d=p.next();!d.done;d=p.next()){var v=d.value;try{Ee(v)}catch(t){o=null!=o?o:[],t instanceof Ie?o=u(u([],s(o)),s(t.errors)):o.push(t)}}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}}if(o)throw new Ie(o)}},t.prototype.add=function(n){var e;if(n&&n!==this)if(this.closed)Ee(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._teardowns=null!==(e=this._teardowns)&&void 0!==e?e:[]).push(n)}},t.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},t.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},t.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&Pe(n,t)},t.prototype.remove=function(n){var e=this._teardowns;e&&Pe(e,n),n instanceof t&&n._removeParent(this)},t.EMPTY=((n=new t).closed=!0,n),t}(),Te=ze.EMPTY;function Ae(t){return t instanceof ze||t&&"closed"in t&&Se(t.remove)&&Se(t.add)&&Se(t.unsubscribe)}function Ee(t){Se(t)?t():t.unsubscribe()}var Re={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},xe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return setTimeout.apply(void 0,u([],s(t)))};function Le(t){xe((function(){throw t}))}function je(){}function Ue(t){t()}var Fe=function(t){function e(n){var e=t.call(this)||this;return e.isStopped=!1,n?(e.destination=n,Ae(n)&&n.add(e)):e.destination=Ge,e}return n(e,t),e.create=function(t,n,e){return new Ne(t,n,e)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ze),Ne=function(t){function e(n,e,r){var o,i=t.call(this)||this;if(Se(n))o=n;else if(n){var c;o=n.next,e=n.error,r=n.complete,i&&Re.useDeprecatedNextContext?(c=Object.create(n)).unsubscribe=function(){return i.unsubscribe()}:c=n,o=null==o?void 0:o.bind(c),e=null==e?void 0:e.bind(c),r=null==r?void 0:r.bind(c)}return i.destination={next:o?Me(o):je,error:Me(null!=e?e:De),complete:r?Me(r):je},i}return n(e,t),e}(Fe);function Me(t,n){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];try{t.apply(void 0,u([],s(n)))}catch(t){Le(t)}}}function De(t){throw t}var Ge={closed:!0,next:je,error:De,complete:je},Be="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ke(t){return t}function qe(t){return 0===t.length?Ke:1===t.length?t[0]:function(n){return t.reduce((function(t,n){return n(t)}),n)}}var He=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(n){var e=new t;return e.source=this,e.operator=n,e},t.prototype.subscribe=function(t,n,e){var r,o=this,i=(r=t)&&r instanceof Fe||function(t){return t&&Se(t.next)&&Se(t.error)&&Se(t.complete)}(r)&&Ae(r)?t:new Ne(t,n,e);return Ue((function(){var t=o,n=t.operator,e=t.source;i.add(n?n.call(i,e):e?o._subscribe(i):o._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},t.prototype.forEach=function(t,n){var e=this;return new(n=Ye(n))((function(n,r){var o;o=e.subscribe((function(n){try{t(n)}catch(t){r(t),null==o||o.unsubscribe()}}),r,n)}))},t.prototype._subscribe=function(t){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(t)},t.prototype[Be]=function(){return this},t.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return qe(t)(this)},t.prototype.toPromise=function(t){var n=this;return new(t=Ye(t))((function(t,e){var r;n.subscribe((function(t){return r=t}),(function(t){return e(t)}),(function(){return t(r)}))}))},t.create=function(n){return new t(n)},t}();function Ye(t){var n;return null!==(n=null!=t?t:Re.Promise)&&void 0!==n?n:Promise}function $e(t){return function(n){if(function(t){return Se(null==t?void 0:t.lift)}(n))return n.lift((function(n){try{return t(n,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var We=function(t){function e(n,e,r,o,i){var c=t.call(this,n)||this;return c.onFinalize=i,c._next=e?function(t){try{e(t)}catch(t){n.error(t)}}:t.prototype._next,c._error=o?function(t){try{o(t)}catch(t){n.error(t)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(t){n.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,c}return n(e,t),e.prototype.unsubscribe=function(){var n,e=this.closed;t.prototype.unsubscribe.call(this),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))},e}(Fe),Ze=Ce((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ve=function(t){function e(){var n=t.call(this)||this;return n.closed=!1,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return n(e,t),e.prototype.lift=function(t){var n=new Je(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ze},e.prototype.next=function(t){var n=this;Ue((function(){var e,r;if(n._throwIfClosed(),!n.isStopped){var o=n.observers.slice();try{for(var i=a(o),c=i.next();!c.done;c=i.next()){c.value.next(t)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}}}))},e.prototype.error=function(t){var n=this;Ue((function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var e=n.observers;e.length;)e.shift().error(t)}}))},e.prototype.complete=function(){var t=this;Ue((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,e=n.hasError,r=n.isStopped,o=n.observers;return e||r?Te:(o.push(t),new ze((function(){return Pe(o,t)})))},e.prototype._checkFinalizedStatuses=function(t){var n=this,e=n.hasError,r=n.thrownError,o=n.isStopped;e?t.error(r):o&&t.complete()},e.prototype.asObservable=function(){var t=new He;return t.source=this,t},e.create=function(t,n){return new Je(t,n)},e}(He),Je=function(t){function e(n,e){var r=t.call(this)||this;return r.destination=n,r.source=e,r}return n(e,t),e.prototype.next=function(t){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===e||e.call(n,t)},e.prototype.error=function(t){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===e||e.call(n,t)},e.prototype.complete=function(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)},e.prototype._subscribe=function(t){var n,e;return null!==(e=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==e?e:Te},e}(Ve),Qe=function(t){function e(n){var e=t.call(this)||this;return e._value=n,e}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var e=t.prototype._subscribe.call(this,n);return!e.closed&&n.next(this._value),e},e.prototype.getValue=function(){var t=this,n=t.hasError,e=t.thrownError,r=t._value;if(n)throw e;return this._throwIfClosed(),r},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Ve),Xe=function(){return Date.now()},tr=function(t){function e(n,e){return t.call(this)||this}return n(e,t),e.prototype.schedule=function(t,n){return this},e}(ze),nr={setInterval:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=nr.delegate;return((null==e?void 0:e.setInterval)||setInterval).apply(void 0,u([],s(t)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},er=function(t){function e(n,e){var r=t.call(this,n,e)||this;return r.scheduler=n,r.work=e,r.pending=!1,r}return n(e,t),e.prototype.schedule=function(t,n){if(void 0===n&&(n=0),this.closed)return this;this.state=t;var e=this.id,r=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(r,e,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(r,this.id,n),this},e.prototype.requestAsyncId=function(t,n,e){return void 0===e&&(e=0),nr.setInterval(t.flush.bind(t,this),e)},e.prototype.recycleAsyncId=function(t,n,e){if(void 0===e&&(e=0),null!=e&&this.delay===e&&!1===this.pending)return n;nr.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var e=this._execute(t,n);if(e)return e;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var e,r=!1;try{this.work(t)}catch(t){r=!0,e=t||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),e},e.prototype.unsubscribe=function(){if(!this.closed){var n=this.id,e=this.scheduler,r=e.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Pe(r,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(tr),rr=function(){function t(n,e){void 0===e&&(e=t.now),this.schedulerActionCtor=n,this.now=e}return t.prototype.schedule=function(t,n,e){return void 0===n&&(n=0),new this.schedulerActionCtor(this,t).schedule(e,n)},t.now=Xe,t}(),or=new(function(t){function e(n,e){void 0===e&&(e=rr.now);var r=t.call(this,n,e)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return n(e,t),e.prototype.flush=function(t){var n=this.actions;if(this._active)n.push(t);else{var e;this._active=!0;do{if(e=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,e){for(;t=n.shift();)t.unsubscribe();throw e}}},e}(rr))(er),ir=or,cr=new He((function(t){return t.complete()}));function ar(t){return t&&Se(t.schedule)}function sr(t){return ar((n=t)[n.length-1])?t.pop():void 0;var n}var ur=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function lr(t){return Se(null==t?void 0:t.then)}function fr(t){return Se(t[Be])}function hr(t){return Symbol.asyncIterator&&Se(null==t?void 0:t[Symbol.asyncIterator])}function pr(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var dr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function vr(t){return Se(null==t?void 0:t[dr])}function gr(t){return f(this,arguments,(function(){var n,e,r;return c(this,(function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,l(n.read())];case 3:return e=o.sent(),r=e.value,e.done?[4,l(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,l(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}}))}))}function yr(t){return Se(null==t?void 0:t.getReader)}function mr(t){if(t instanceof He)return t;if(null!=t){if(fr(t))return o=t,new He((function(t){var n=o[Be]();if(Se(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(ur(t))return r=t,new He((function(t){for(var n=0;n<r.length&&!t.closed;n++)t.next(r[n]);t.complete()}));if(lr(t))return e=t,new He((function(t){e.then((function(n){t.closed||(t.next(n),t.complete())}),(function(n){return t.error(n)})).then(null,Le)}));if(hr(t))return br(t);if(vr(t))return n=t,new He((function(t){var e,r;try{for(var o=a(n),i=o.next();!i.done;i=o.next()){var c=i.value;if(t.next(c),t.closed)return}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}t.complete()}));if(yr(t))return br(gr(t))}var n,e,r,o;throw pr(t)}function br(t){return new He((function(n){(function(t,n){var e,r,o,a;return i(this,void 0,void 0,(function(){var i,s;return c(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),e=h(t),c.label=1;case 1:return[4,e.next()];case 2:if((r=c.sent()).done)return[3,4];if(i=r.value,n.next(i),n.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),o={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(a=e.return)?[4,a.call(e)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}}))}))})(t,n).catch((function(t){return n.error(t)}))}))}function wr(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=n.schedule((function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()}),r);if(t.add(i),!o)return i}function _r(t,n){return void 0===n&&(n=0),$e((function(e,r){e.subscribe(new We(r,(function(e){return wr(r,t,(function(){return r.next(e)}),n)}),(function(){return wr(r,t,(function(){return r.complete()}),n)}),(function(e){return wr(r,t,(function(){return r.error(e)}),n)})))}))}function kr(t,n){return void 0===n&&(n=0),$e((function(e,r){r.add(t.schedule((function(){return e.subscribe(r)}),n))}))}function Or(t,n){if(!t)throw new Error("Iterable cannot be null");return new He((function(e){wr(e,n,(function(){var r=t[Symbol.asyncIterator]();wr(e,n,(function(){r.next().then((function(t){t.done?e.complete():e.next(t.value)}))}),0,!0)}))}))}function Sr(t,n){if(null!=t){if(fr(t))return function(t,n){return mr(t).pipe(kr(n),_r(n))}(t,n);if(ur(t))return function(t,n){return new He((function(e){var r=0;return n.schedule((function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())}))}))}(t,n);if(lr(t))return function(t,n){return mr(t).pipe(kr(n),_r(n))}(t,n);if(hr(t))return Or(t,n);if(vr(t))return function(t,n){return new He((function(e){var r;return wr(e,n,(function(){r=t[dr](),wr(e,n,(function(){var t,n,o;try{n=(t=r.next()).value,o=t.done}catch(t){return void e.error(t)}o?e.complete():e.next(n)}),0,!0)})),function(){return Se(null==r?void 0:r.return)&&r.return()}}))}(t,n);if(yr(t))return function(t,n){return Or(gr(t),n)}(t,n)}throw pr(t)}function Cr(t,n){return n?Sr(t,n):mr(t)}function Ir(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=sr(t);return Cr(t,e)}function Pr(t,n){return $e((function(e,r){var o=0;e.subscribe(new We(r,(function(e){r.next(t.call(n,e,o++))})))}))}function zr(t,n,e){return void 0===e&&(e=1/0),Se(n)?zr((function(e,r){return Pr((function(t,o){return n(e,t,r,o)}))(mr(t(e,r)))}),e):("number"==typeof n&&(e=n),$e((function(n,r){return function(t,n,e,r,o,i,c,a){var s=[],u=0,l=0,f=!1,h=function(){!f||s.length||u||n.complete()},p=function(t){return u<r?d(t):s.push(t)},d=function(t){i&&n.next(t),u++;var a=!1;mr(e(t,l++)).subscribe(new We(n,(function(t){null==o||o(t),i?p(t):n.next(t)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var t=function(){var t=s.shift();c?wr(n,c,(function(){return d(t)})):d(t)};s.length&&u<r;)t();h()}catch(t){n.error(t)}})))};return t.subscribe(new We(n,p,(function(){f=!0,h()}))),function(){null==a||a()}}(n,r,t,e)})))}function Tr(){return void 0===(t=1)&&(t=1/0),zr(Ke,t);var t}function Ar(t,n,e){void 0===t&&(t=0),void 0===e&&(e=ir);var r=-1;return null!=n&&(ar(n)?e=n:r=n),new He((function(n){var o,i=(o=t)instanceof Date&&!isNaN(o)?+t-e.now():t;i<0&&(i=0);var c=0;return e.schedule((function(){n.closed||(n.next(c++),0<=r?this.schedule(void 0,r):n.complete())}),i)}))}function Er(t){return $e((function(n,e){var r,o=null,i=!1;o=n.subscribe(new We(e,void 0,void 0,(function(c){r=mr(t(c,Er(t)(n))),o?(o.unsubscribe(),o=null,r.subscribe(e)):i=!0}))),i&&(o.unsubscribe(),o=null,r.subscribe(e))}))}function Rr(t){return t<=0?function(){return cr}:$e((function(n,e){var r=0;n.subscribe(new We(e,(function(n){++r<=t&&(e.next(n),t<=r&&e.complete())})))}))}function xr(t,n){return n?function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Tr()(Cr(t,sr(t)))}(n.pipe(Rr(1),$e((function(t,n){t.subscribe(new We(n,je))}))),e.pipe(xr(t)))}:zr((function(n,e){return t(n,e).pipe(Rr(1),function(t){return Pr((function(){return t}))}(n))}))}function Lr(t,n){return $e((function(e,r){var o=null,i=0,c=!1,a=function(){return c&&!o&&r.complete()};e.subscribe(new We(r,(function(e){null==o||o.unsubscribe();var c=0,s=i++;mr(t(e,s)).subscribe(o=new We(r,(function(t){return r.next(n?n(e,t,s,c++):t)}),(function(){o=null,a()})))}),(function(){c=!0,a()})))}))}function jr(t,n,e){var r=Se(t)||n||e?{next:t,error:n,complete:e}:t;return r?$e((function(t,n){var e;null===(e=r.subscribe)||void 0===e||e.call(r);var o=!0;t.subscribe(new We(n,(function(t){var e;null===(e=r.next)||void 0===e||e.call(r,t),n.next(t)}),(function(){var t;o=!1,null===(t=r.complete)||void 0===t||t.call(r),n.complete()}),(function(t){var e;o=!1,null===(e=r.error)||void 0===e||e.call(r,t),n.error(t)}),(function(){var t,n;o&&(null===(t=r.unsubscribe)||void 0===t||t.call(r)),null===(n=r.finalize)||void 0===n||n.call(r)})))})):Ke}var Ur,Fr="https://".concat("business.automizely.io"),Nr=!1;!function(t){t.FLOW_START="FLOW_START",t.FETCH_ORGANIZATION="FETCH_ORGANIZATION",t.FETCH_ORGANIZATION_END="FETCH_ORGANIZATION_END",t.START_ANIMATION="START_ANIMATION",t.CREATE_ORG_PAGE="CREATE_ORG_PAGE",t.SELECT_ORG_PAGE="SELECT_ORG_PAGE",t.FLOW_END="FLOW_END"}(Ur||(Ur={}));var Mr,Dr=function(t){var n,r=(n=t,{generateUrl:function(t){return"https://".concat("api.automizely.io","/businesses/v1").concat(t)},getAppsConnection:function(t){return i(this,void 0,void 0,(function(){return c(this,(function(e){return[2,n.sendRequest(this.generateUrl("/connections"),{app_name:t.name,app_platform:t.platform,app_key:t.key},"GET",!1)]}))}))},createOrganization:function(t){return i(this,void 0,void 0,(function(){return c(this,(function(e){return[2,n.sendRequest(this.generateUrl("/organizations"),t,"POST",!1)]}))}))},createAppConnection:function(t){return i(this,void 0,void 0,(function(){return c(this,(function(e){return[2,n.sendRequest(this.generateUrl("/app-connections"),t,"POST",!1)]}))}))},getOrganizationPreFilling:function(t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var r,o,i;return c(this,(function(c){switch(c.label){case 0:return r={},t.app_key&&(r.app_key=t.app_key),[4,Promise.all([n.sendRequest(this.generateUrl("/app-connections/organization-pre-filling"),r,"GET",!1),n.sendRequest(this.generateUrl("/public/timezones"),null,"GET",!1)])];case 1:return o=c.sent(),i=o[0],[2,{timezone_list:o[1].timezones.map((function(t){return{value:t.identifier,label:"(GMT".concat(t.offset,") ").concat(t.identifier)}})),filling_data:e(e({},i),{protocol:"https://",estimated_monthly_orders:i.estimated_monthly_orders})}]}}))}))}});function o(t){var n=t.appInfo,e=t.connectionOrgList;return p.pipe(Lr((function(t){return Ir(!0).pipe(Lr((function(){return"orgSelected"===t.type?u({organization:{id:t.orgId},app:n},{selectedConnection:e.find((function(n){return n.organization.id===t.orgId}))}):function(t){return a(t).pipe(Lr((function(n){return t.app?u({organization:{id:n.id},app:t.app}):Ir(n)})))}({org:t.org,app:n})})),Lr((function(n){return t.onSubmitSuccess(),p.complete(),Ir(n)})),Er((function(r){return t.onSubmitError(r),o({appInfo:n,connectionOrgList:e})})))})))}function a(t){return Cr(r.createOrganization(t.org)).pipe(jr((function(){Nr=!0})))}function s(t){return Cr(r.getOrganizationPreFilling(t)).pipe(Lr((function(t){return a({org:e(e({},t.filling_data),{url:t.filling_data.protocol+t.filling_data.url})})})),function(t){var n;void 0===t&&(t=1/0);var e=(n=t&&"object"==typeof t?t:{count:t}).count,r=void 0===e?1/0:e,o=n.delay,i=n.resetOnSuccess,c=void 0!==i&&i;return r<=0?Ke:$e((function(t,n){var e,i=0,a=function(){var s=!1;e=t.subscribe(new We(n,(function(t){c&&(i=0),n.next(t)}),void 0,(function(t){if(i++<r){var c=function(){e?(e.unsubscribe(),e=null,a()):s=!0};if(null!=o){var u="number"==typeof o?Ar(o):mr(o(t,i)),l=new We(n,(function(){l.unsubscribe(),c()}),(function(){n.complete()}));u.subscribe(l)}else c()}else n.error(t)}))),s&&(e.unsubscribe(),e=null,a())};a()}))}(3))}function u(t,n){var e=(void 0===n?{}:n).selectedConnection;return Cr(r.createAppConnection(t)).pipe(Er((function(t){var n,r,o,i,c;return(null===(n=null==t?void 0:t.meta)||void 0===n?void 0:n.code)>=4e4&&40321===t.meta.code?h.pipe(Lr((function(){var t=Fr+"/organizations/third-party-login/no-access?withoutSidebar=true&owner_email=".concat(null==e?void 0:e.organization_owner_email,"&organization_name=").concat(null==e?void 0:e.organization.name,"&org_id=").concat(null==e?void 0:e.organization.id);return window.location.replace(t),Ar(1e3)}))):(i=Se(r=function(){return t})?r:function(){return r},c=function(t){return t.error(i())},new He(o?function(t){return o.schedule(c,0,t)}:c))})))}var l,f=new Qe(Ur.FLOW_START),h=new Ve,p=new Ve;return{runFlow:(l=t,function(t){var n,i=t.withoutCreateOrganization,c=t.setToast,a=new URLSearchParams(window.location.search),p=a.get("app_name")||"",d=a.get("app_platform")||"",v=a.get("app_key")||"",g="connect"===a.get("continue");return f.next(Ur.FETCH_ORGANIZATION),{flowObservable$:Cr(l.getOrganizations()).pipe(Lr((function(n){if(f.next(Ur.FETCH_ORGANIZATION_END),!g)return 0!==n.length||i?Ir(null):(Nr=!0,s({app_key:v}));f.next(Ur.START_ANIMATION);var c,a={key:v,platform:d,name:p};return(c=a,Cr(r.getAppsConnection(c))).pipe(Lr((function(r){return function(t){var n=t.connections,r=t.appName,i=t.appInfo,c=t.orgList,a=t.flowParams,l=t.appKey,p=Oe(n,(function(t){return t.organization.id}));return 0===p.length?function(t){var n,e=t.orgList,r=t.openSelectOrgPage,i=t.openCreateOrgPage,c=t.appInfo,a=t.appKey;return e.length>0?h.pipe(Lr((function(){return f.next(Ur.SELECT_ORG_PAGE),r({app:c,selectOrgListData:{isPlatform:!1,organizations:e},openCreateOrgPage:function(){i({}),f.next(Ur.CREATE_ORG_PAGE)}}),o({appInfo:c,connectionOrgList:[]})}))):Cr(s((n={app:c,params:{app_key:a}}).params)).pipe(Lr((function(t){return n.app?u({organization:{id:t.id},app:n.app}):Ir(t)})))}(e(e({},a),{appInfo:i,orgList:c,appKey:l})):1===p.length?u({organization:{id:p[0].organization.id},app:i},{selectedConnection:p[0]}):function(t){var n=t.connectionOrgList,e=t.openSelectOrgPage,r=t.openCreateOrgPage,i=t.connections,c=t.appName,a=t.appInfo,s=i.find((function(t){return t.app.name===c}));return s?u({organization:{id:s.organization.id},app:a},{selectedConnection:s}):h.pipe(Lr((function(){return f.next(Ur.SELECT_ORG_PAGE),e({app:a,selectOrgListData:{isPlatform:!0,connections:n},openCreateOrgPage:function(){r({app:a}),f.next(Ur.CREATE_ORG_PAGE)}}),o({appInfo:a,connectionOrgList:n})})))}(e(e({},a),{connectionOrgList:p,connections:n,appName:r,appInfo:i}))}({appInfo:a,appName:p,orgList:n,connections:r.connections,flowParams:t,appKey:v})})))})),Er((function(t){var n;return console.log(t.meta),c({message:(null===(n=null==t?void 0:t.meta)||void 0===n?void 0:n.message)||String(t),error:!0}),Ar(2e3).pipe(jr((function(){window.location.replace(Fr)})),function(t,n){void 0===n&&(n=or);var e=Ar(t,n);return xr((function(){return e}))}(1e3))})),Lr((function(){return g?h:Ir(null)})),jr((function(){if(Nr)try{window.datacat("event","conversion",{send_to:"AW-947712838/YDJwCL77g_YCEMbm88MD"}),window.uetq.push("event","page_view",{page_path:location.pathname})}catch(t){}else if(g)try{window.datacat("event","conversion",{send_to:"AW-947712838/R5USCN_z3_UCEMbm88MD"}),window.uetq.push("event","page_view",{page_path:location.pathname})}catch(t){}})),(n=function(){l.loadAccountsMembershipAndConnections(Nr),f.next(Ur.FLOW_END),g&&window.history.replaceState({},document.title,"/")},$e((function(t,e){try{t.subscribe(e)}finally{e.add(n)}}))))}}),formSubmitSubject:p,animationEventSubject:h,flowStepSubject:f,FlowStep:Ur}},Gr=function(t){return new Promise((function(n){return setTimeout(n,t)}))},Br=function(t){try{dispatchEvent(new Event("loaded"===t?"authCoreLoadedEvent":"authCoreInitializedEvent"))}catch(t){}},Kr=/(^[a-zA-Z0-9][a-zA-Z0-9-]*).myshopify.com/,qr="52px",Hr="var(--asnv-nav-banner-topbar-offset, 0px)",Yr="logout_btn",$r="impersonator_banner",Wr="impersonate-admin-style",Zr='\n\t<div style="\n\t\theight: '.concat(qr,';\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tborder: 1px solid #F5C452;\n\t\tbackground-color: #FCF0D4;\n\t\tpadding: 12px 16px 12px 16px;"\n\t>\n\t\t<div style="line-height: 24px;\n\t\t\t\tfont-weight: 600;\n\t\t\t\tfont-size: 16px;\n\t\t\t\tcolor: #1F2124;"\n\t\t>\n\t\t\tAttention: You are currently logged in to this system using Account Impersonation\n\t\t</div>\n\t\t<button\n\t\t\tid=').concat(Yr,'\n\t\t\ttype="button"\n\t\t\tstyle="border: 1px solid #F5C452;\n\t\t\t\tborder-radius: 4px;\n\t\t\t\tbackground: #FEF8EC;\n\t\t\t\tcolor: #1F2124;\n\t\t\t\tcursor: pointer;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding: 8px 16px;\n\t\t\t\ttext-align: center;"\n\t\t>\n\t\t\tLogout\n\t\t</button>\n\t</div>\n'),Vr="\n\t\t.".concat(Wr," .workshop-savebar {\n\t\t\ttop: ").concat(qr,";\n\t\t\tz-index: 513;\n\t\t}\n\t\t.").concat(Wr," .fullscreen-workshop {\n\t\t\tpadding-top: ").concat("56px",";\n\t\t\ttop: ").concat(qr,";\n\t\t\theight: calc(100% - ").concat(qr,");\n\t\t}\n\t"),Jr="\n\t\t.".concat(Wr," .Polaris-Frame__Navigation {\n\t\t\ttransform: translateY(").concat(qr,");\n\t\t\tpadding-bottom: ").concat(qr,";\n\t\t}\n\t\t.").concat(Wr," .sheet-container {\n\t\t\tz-index: 513;\n\t\t\ttop: calc(").concat(Hr," + ").concat(qr,");\n\t\t\theight: calc(100% - ").concat(Hr," - ").concat(qr,");\n\t\t}\n\t"),Qr="\n\t\t.".concat(Wr," .asnv-layout-banner-top {\n\t\t\ttop: ").concat(qr,";\n\t\t}\n\n\t\t.").concat(Wr," .asnv-layout-top {\n\t\t\ttop: calc(").concat(Hr," + ").concat(qr,");\n\t\t}\n\n\t\t.").concat(Wr," .asnv-layout-left {\n\t\t\ttop: calc(").concat(Hr," + ").concat(qr,");\n\t\t}\n\n\t\t.").concat(Wr," .asnv-navigation {\n\t\t\theight: calc(100% - ").concat(Hr," - ").concat(qr,");\n\t\t}\n\n\t\t.").concat(Wr," .asnv-layout .asnv-layout-main  {\n\t\t\tpadding-top: calc(").concat(Hr," + ").concat(qr,");\n\t\t}\n\n\t\t.").concat(Wr," .asnv-layout .Polaris-Frame {\n\t\t\tmin-height: calc(100vh - ").concat(Hr," - ").concat("var(--asnv-nav-topbar-offset, 0px)"," - ").concat(qr,");\n\t\t}\n\n\n\t\t").concat(Jr,"\n\t\t").concat(Vr,"\n\t"),Xr="\n\t\t.".concat(Wr," .Polaris-Frame__Main {\n\t\t\tposition: relative;\n\t\t\ttop: ").concat(qr,";\n\t\t}\n\n\t\t.").concat(Wr," .Polaris-Frame__TopBar {\n\t\t\ttop: ").concat(qr,";\n\t\t}\n\n\t\t").concat(Jr,"\n\t\t").concat(Vr,"\n\t"),to=function(){!function(t){if(!document.getElementById($r)){var n=document.body,e=document.createElement("div");e.id=$r,e.innerHTML=Zr,e.setAttribute("style","width: 100vw; position: fixed; top: 0px; z-index: 100;"),n.append(e);var r=document.getElementById($r);if(r){var o=r.querySelector("#".concat(Yr));null==o||o.addEventListener("click",(function(){var t;(null===window||void 0===window?void 0:window.getAuth)&&(null===(t=null===window||void 0===window?void 0:window.getAuth())||void 0===t||t.logout())})),t&&t()}}}((function(){!function(){var t=document.createElement("style");t.setAttribute("type","text/css");var n=document.getElementById("aftership-admin-skeleton")?Qr:Xr;t.innerHTML=n,document.head.append(t),document.body.classList.add(Wr)}()}))};function no(t){return function(n,e,r){var o=r.value;return r.value=function(){for(var n,r,i,c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];var s=null===(i=null===(r=null===(n=this)||void 0===n?void 0:n.getConfig)||void 0===r?void 0:r.call(n))||void 0===i?void 0:i.clientId,u=t===Mr.COMPANY&&s!==Mr.COMPANY,l=t===Mr.ORGANIZATION&&s===Mr.COMPANY;return u||l?Promise.reject(new Error("The current workspace not ".concat(t,", cannot use the ").concat(e," method, please check AuthProvider config"))):o.apply(this,c)},r}}!function(t){t.ORGANIZATION="organization",t.COMPANY="company"}(Mr||(Mr={}));var eo=no(Mr.ORGANIZATION),ro=no(Mr.COMPANY),oo=["business.automizely.io","partners.automizely.io"],io=["klaviyo"],co=function(t){function a(n){var e=t.call(this,n)||this;return e.config=n,e.thirdPartyFlow=Dr(e),e.currentOrganization=null,e.currentCompany=null,e.connections=[],e.currentConnection=null,e.connectionsOfOrganization=[],e.connectionByAppName=new Map,e.accountsMembership=null,e.organizations=[],e.organizationResolvers=[],e.companies=[],e.companyResolvers=[],e.legacyTokenResolvers=[],e.connectionResolvers=[],e.connectionFetched=!1,e.membershipFetched=!1,e.membershipResolvers=[],e.companySwitched=!1,e.connectionUpdated=!1,e.legacyToken=null,e.membershipFetchPending=new Promise((function(t){e.membershipFetchResolver=t})),e.on("init",(function(){var t,n;(null===(n=null===(t=e.tokenParsed)||void 0===t?void 0:t.impersonator)||void 0===n?void 0:n.username)&&to()})),e.on("token",(function(){return i(e,void 0,void 0,(function(){var t,n;return c(this,(function(e){switch(e.label){case 0:return this.config.legacyToken&&this.currentOrganization?(t=this,[4,this.fetchLegacyToken()]):[3,2];case 1:t.legacyToken=e.sent(),this.emit("legacyToken","".concat(null===(n=this.tokenParsed)||void 0===n?void 0:n.typ," ").concat(this.legacyToken)),e.label=2;case 2:return[2]}}))}))})),e.on("legacyToken",(function(){for(;e.legacyTokenResolvers.length;){var t=e.legacyTokenResolvers.pop();t&&t()}})),e.on("organization",(function(){for(;e.organizationResolvers.length;){var t=e.organizationResolvers.pop();t&&t()}})),e.on("company",(function(){for(;e.companyResolvers.length;){var t=e.companyResolvers.pop();t&&t()}})),e.on("accountsMembership",(function(){for(;e.membershipResolvers.length;){var t=e.membershipResolvers.pop();t&&t()}})),e.on("connection",(function(){var t;for(e.connectionUpdated=!0;e.connectionResolvers.length;){var n=e.connectionResolvers.pop();n&&n()}(null===(t=e.config.appConfig)||void 0===t?void 0:t.name)&&e.connectionByAppName.set(e.config.appConfig.name,{connections:e.connections,currentConnection:e.currentConnection,connectionsOfOrganization:e.connectionsOfOrganization}),e.emit("connections",(function(){}))})),e.on("organization:switched",(function(){R()})),e.config.skipAutoFetchOrganizations||(e.config.refreshPageAtConnectionSwitched&&(e.config.refreshPageAtOrganizationSwitched=!0),e.config.enableNewThirdPartyLoginFlow?e.fetchAccountsMembership().catch((function(t){return e.emit("error",t)})):e.loadAccountsMembershipAndConnections(!0).catch((function(t){e.emit("error",t)}))),e}return n(a,t),a.getInstance=function(t){if(!this.authInstance){if(t)return this.authInstance=new a(t),Br("initialized"),this.authInstance;throw new Error("Should create auth instance first.")}return t&&this.authInstance.onConfigChange(t),this.authInstance},Object.defineProperty(a.prototype,"generateSwitchOrganizationOrAppURL",{get:function(){return this.config.generateSwitchOrganizationOrAppURL},enumerable:!1,configurable:!0}),a.prototype.onConfigChange=function(n){t.prototype.onConfigChange.call(this,n),this.setConnectionByConfig(null==n?void 0:n.appConfig)},a.prototype.setConnectionByConfig=function(t){var n,e=this,r=null==t?void 0:t.name;if((null===(n=this.currentConnection)||void 0===n?void 0:n.app.name)!==r){if(!r)return this.currentConnection=null,this.connections=[],void(this.connectionsOfOrganization=[]);this.connectionUpdated=!1;var o=this.connectionByAppName.get(r);if(o)return this.currentConnection=o.currentConnection,this.connections=o.connections,this.connectionsOfOrganization=o.connectionsOfOrganization,void this.emit("connection",this.currentConnection);this.connectionFetched=!1,this.fetchConnections().finally((function(){return i(e,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.updateConnectionsOfOrganization()];case 1:return n.sent(),t=this,[4,this.guessCurrentConnection()];case 2:return t.currentConnection=n.sent(),this.emit("connection",this.currentConnection),[2]}}))}))}))}},a.prototype.loadAccountsMembershipAndConnections=function(t){var n;return i(this,void 0,void 0,(function(){var e,r,o,i,a,s;return c(this,(function(c){switch(c.label){case 0:return e=t?this.fetchAccountsMembership():Promise.resolve(this.accountsMembership),[4,Promise.all([e,this.fetchConnections()])];case 1:return r=c.sent(),o=r[1],i=this.config.clientId,"company"===i?[4,this.guessCurrentCompany()]:[3,4];case 2:return a=c.sent(),[4,this.switchCompany(a)];case 3:return c.sent(),[3,9];case 4:return(null===(n=this.config.appConfig)||void 0===n?void 0:n.name)?[4,this.handleInitOrganizationAndConnection(o)]:[3,6];case 5:return c.sent(),[3,9];case 6:return[4,this.guessCurrentOrganization()];case 7:return s=c.sent(),[4,this.handleInitOrganization(s)];case 8:c.sent(),c.label=9;case 9:return[2]}}))}))},a.prototype.getConfig=function(){return this.config},a.prototype.getConnection=function(){return i(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){return this.connectionUpdated?[2,Promise.resolve(this.currentConnection)]:[2,new Promise((function(n){return t.connectionResolvers.push(n)})).then((function(){return t.currentConnection}))]}))}))},a.prototype.getConnections=function(){return i(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){return this.connectionFetched?[2,Promise.resolve(this.connections)]:[2,new Promise((function(n){return t.connectionResolvers.push(n)})).then((function(){return t.connections}))]}))}))},a.prototype.getConnectionsOfOrganization=function(){return i(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){return this.connectionUpdated?[2,Promise.resolve(this.connectionsOfOrganization)]:[2,new Promise((function(n){return t.connectionResolvers.push(n)})).then((function(){return t.connectionsOfOrganization}))]}))}))},a.prototype.getAuthorization=function(n){var e;return i(this,void 0,void 0,(function(){var r=this;return c(this,(function(o){switch(o.label){case 0:return this.initialized?[4,this.updateKeycloakToken()]:[3,2];case 1:o.sent()&&(this.legacyToken=null),o.label=2;case 2:if("newest"===n||!n)return[2,t.prototype.getAuthorization.call(this)];if("legacy"===n&&!this.config.legacyToken)throw new Error("Could not initial legacy token settings.");return this.legacyToken?[2,Promise.resolve("".concat(null===(e=this.tokenParsed)||void 0===e?void 0:e.typ," ").concat(this.legacyToken))]:[2,new Promise((function(t){return r.legacyTokenResolvers.push(t)})).then((function(){var t;return"".concat(null===(t=r.tokenParsed)||void 0===t?void 0:t.typ," ").concat(r.legacyToken)}))]}}))}))},a.prototype.switchConnection=function(t,n){var e,r,o;return i(this,void 0,void 0,(function(){var i,a,s;return c(this,(function(c){switch(c.label){case 0:return(this.config.refreshPageAtConnectionSwitched||this.config.refreshPageAtOrganizationSwitched)&&n?[4,this.getUserInfo()]:[3,2];case 1:i=c.sent().account_id,a=d.replace(":AC_ID",i);try{window.localStorage.setItem(a,n)}catch(t){}c.label=2;case 2:return(null===(e=this.currentOrganization)||void 0===e?void 0:e.id)===t?[3,4]:[4,this.switchOrganization(t)];case 3:c.sent(),c.label=4;case 4:if((null===(r=this.currentConnection)||void 0===r?void 0:r.id)&&(null===(o=this.currentConnection)||void 0===o?void 0:o.id)!==n&&this.config.refreshPageAtConnectionSwitched)return this.generateSwitchOrganizationOrAppURL?window.location.href=this.generateSwitchOrganizationOrAppURL("connection"):window.location.reload(),[2];if(!n&&this.connectionsOfOrganization.length)return this.currentConnection=this.connectionsOfOrganization[0],this.emit("connection",this.currentConnection),[2];if(!n&&!this.connectionsOfOrganization.length)return this.currentConnection=null,this.emit("connection",null),[2];if(!(s=this.connectionsOfOrganization.find((function(t){return t.id===n}))))throw new Error("Could not find the ".concat(n," in connections"));return this.currentConnection=s,this.emit("connection",s),[2]}}))}))},a.prototype.switchOrganization=function(t){var n,e;return i(this,void 0,void 0,(function(){var r,o,i,a,s,u;return c(this,(function(c){switch(c.label){case 0:if(!(r=this.organizations.find((function(n){return n.id===t}))))throw new Error("Could not find the ".concat(t," in organizations."));return o=this.currentOrganization,this.currentOrganization=r,[4,this.getUserInfo()];case 1:i=c.sent().account_id,a=p.replace(":AC_ID",i);try{window.localStorage.setItem(a,r.id)}catch(t){}return this.emit("organization",this.currentOrganization),o&&this.emit("organization:switched"),[4,this.checkPageAccessAuthority()];case 2:return c.sent()?o&&this.config.refreshPageAtOrganizationSwitched?(this.generateSwitchOrganizationOrAppURL?window.location.href=this.generateSwitchOrganizationOrAppURL("organization"):window.location.reload(),[2]):this.config.legacyToken?(u=this,[4,this.fetchLegacyToken()]):[3,4]:((s=new URL("".concat($.ORGANIZATION,"/").concat(X),"https://".concat("admin.aftership.io"))).searchParams.set("hide_nav","true"),s.searchParams.set("organization_id",null===(n=this.currentOrganization)||void 0===n?void 0:n.id),window.location.href=s.href,[2]);case 3:u.legacyToken=c.sent(),this.emit("legacyToken","".concat(null===(e=this.tokenParsed)||void 0===e?void 0:e.typ," ").concat(this.legacyToken)),c.label=4;case 4:return[4,this.updateConnectionsOfOrganization()];case 5:return c.sent(),this.connectionUpdated=!0,[2]}}))}))},a.prototype.switchCompany=function(t){var n,e;return i(this,void 0,void 0,(function(){var r,o,i;return c(this,(function(c){switch(c.label){case 0:return[4,this.membershipFetchPending];case 1:return c.sent(),r=null!==(n=this.companies.find((function(n){return n.id===(null==t?void 0:t.id)})))&&void 0!==n?n:null,this.currentCompany=r,[4,this.getUserInfo()];case 2:o=c.sent().account_id,i=v.replace(":AC_ID",o);try{window.localStorage.setItem(i,null!==(e=null==r?void 0:r.id)&&void 0!==e?e:"")}catch(t){}return this.emit("company",this.currentCompany),this.companySwitched=!0,[2]}}))}))},a.prototype.getOrganizationSync=function(){return console.warn("[Auth SDK]:\n\t\t\tThis method will be deprecated,\n\t\t\tjust only for temporary compatibility for the SDK migration.\n\t\t\tUse the getOrganization instead to.\n\t\t\t"),this.currentOrganization},a.prototype.getOrganization=function(){var t=this;return this.currentOrganization?Promise.resolve(this.currentOrganization):new Promise((function(n){t.organizationResolvers.push(n)})).then((function(){return t.currentOrganization}))},a.prototype.getOrganizations=function(){var t=this;return this.membershipFetched?Promise.resolve(this.organizations):new Promise((function(n){return t.membershipResolvers.push(n)})).then((function(){return t.organizations}))},a.prototype.getCompany=function(){return i(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){return this.companySwitched?[2,Promise.resolve(this.currentCompany)]:[2,new Promise((function(n){t.companyResolvers.push(n)})).then((function(){return t.currentCompany}))]}))}))},a.prototype.getCompanies=function(){var t=this;return this.membershipFetched?Promise.resolve(this.companies):new Promise((function(n){return t.membershipResolvers.push(n)})).then((function(){return t.companies}))},a.prototype.updateConnectionsOfOrganization=function(){return i(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.getOrganization()];case 1:return t=n.sent(),this.connectionsOfOrganization=this.connections.filter((function(n){return n.organization.id===t.id})),[2,this.connectionsOfOrganization]}}))}))},a.prototype.handleInitOrganizationAndConnection=function(t){return i(this,void 0,void 0,(function(){var n,e,r,o;return c(this,(function(i){switch(i.label){case 0:return n=t.map((function(t){return t.organization.id})),[4,this.guessCurrentOrganization(n)];case 1:return e=i.sent(),[4,this.handleInitOrganization(e)];case 2:return i.sent(),e?[4,this.guessCurrentConnection()]:[2];case 3:return r=i.sent(),o=(null==r?void 0:r.organization.id)||e.id,[4,this.switchConnection(o,null==r?void 0:r.id)];case 4:return i.sent(),this.connectionUpdated=!0,[2]}}))}))},a.prototype.handleInitOrganization=function(t){return i(this,void 0,void 0,(function(){var n;return c(this,(function(e){switch(e.label){case 0:return t?[4,this.switchOrganization(t.id)]:[3,2];case 1:return e.sent(),[2];case 2:return this.config.withoutCreateOrganization||(this.config.enableNewThirdPartyLoginFlow||((n=new URL("".concat($.BUSINESS,"/organizations/add"),"https://".concat("admin.aftership.io"))).searchParams.set("redirect",encodeURIComponent(window.location.href)),window.location.replace(n))),[2]}}))}))},a.prototype.checkPageAccessAuthority=function(){return i(this,void 0,void 0,(function(){var t,n,e,r;return c(this,(function(o){switch(o.label){case 0:return t=new URL(window.location.href),[4,Promise.all([this.fetchMemberSeatSubscriptions(),this.checkIsOrganizationFreeSeatsUsedUp()])];case 1:return n=o.sent(),e=n[0],r=n[1],[2,function(t){var n=t.accountSubscription,e=t.isOrganizationFreeSeatsUsedUp,r=t.currentPage,o=t.currentOrganization,i="admin.aftership.io"===r.host;return!(("organization.automizely.io"!==r.host||!r.pathname.includes(X))&&(!i||!r.pathname.startsWith("/".concat($.ORGANIZATION,"/").concat(X)))&&!oo.includes(r.host)&&(!i||!r.pathname.startsWith("/".concat($.BUSINESS)))&&"Owner"!==(null==o?void 0:o.role.name)&&e&&n&&(!n||!n.active))}({accountSubscription:e[0],isOrganizationFreeSeatsUsedUp:r,currentPage:t,currentOrganization:this.currentOrganization})]}}))}))},a.prototype.guessCurrentConnection=function(){return i(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,s;return c(this,(function(c){switch(c.label){case 0:return(t=new URL(window.location.href)).searchParams.has(Q)&&(n=t.searchParams.get(Q),t.searchParams.delete(Q),window.history.replaceState({},document.title,t.toString()),s=this.connectionsOfOrganization.find((function(t){return t.id===n})))||t.searchParams.has(tt)&&(e=t.searchParams.get(tt),t.searchParams.delete(tt),t.searchParams.delete("host"),window.history.replaceState({},document.title,t.toString()),r=function(t){var n=t.match(Kr);return n&&n[1]||""}(e),s=this.connections.find((function(t){return t.app.key===r})))?[2,s]:[4,this.getUserInfo()];case 1:o=c.sent().account_id,i=d.replace(":AC_ID",o),a=null;try{a=window.localStorage.getItem(i)}catch(t){}return a&&(s=this.connectionsOfOrganization.find((function(t){return t.id===a})))?[2,s]:this.connectionsOfOrganization.length?[2,this.connectionsOfOrganization[0]]:[2,null]}}))}))},a.prototype.guessCurrentOrganization=function(t){return i(this,void 0,void 0,(function(){var n,e,r,o,i,a,s;return c(this,(function(c){switch(c.label){case 0:return(n=new URL(window.location.href)).searchParams.has(V)&&(e=n.searchParams.get(V),n.searchParams.delete(V),window.history.replaceState({},document.title,n.toString()),a=this.organizations.find((function(t){return t.id===e})))?[2,a]:[4,this.getUserInfo()];case 1:r=c.sent().account_id,o=p.replace(":AC_ID",r),i=null;try{i=window.localStorage.getItem(o)}catch(t){}return i&&(a=this.organizations.find((function(t){return t.id===i})))?[2,a]:this.organizations.length?(null==t?void 0:t.length)&&(s=this.organizations.find((function(n){return t.includes(n.id)})))?[2,s]:[2,this.organizations[0]]:[2,null]}}))}))},a.prototype.guessCurrentCompany=function(){return i(this,void 0,void 0,(function(){var t,n,e,r,o,i;return c(this,(function(c){switch(c.label){case 0:return[4,this.membershipFetchPending];case 1:return c.sent(),(t=new URL(window.location.href)).searchParams.has(J)&&(n=t.searchParams.get(J),t.searchParams.delete(J),window.history.replaceState({},document.title,t.toString()),i=this.companies.find((function(t){return t.id===n})))?[2,i]:[4,this.getUserInfo()];case 2:e=c.sent().account_id,r=v.replace(":AC_ID",e),o=null;try{o=window.localStorage.getItem(r)}catch(t){}return o&&(i=this.companies.find((function(t){return t.id===o})))?[2,i]:this.companies.length?[2,this.companies[0]]:[2,null]}}))}))},a.prototype.fetchMemberSeatSubscriptions=function(){var t,n;return i(this,void 0,void 0,(function(){var e;return c(this,(function(r){return e="https://".concat("release-incy-api.automizely.io","/billing/v2/subscriptions"),[2,this.sendRequest(e,{organization_id:null===(t=this.currentOrganization)||void 0===t?void 0:t.id,product_code:"accounts",service_code:"member_seats"},"GET",2,{"am-organization-id":(null===(n=this.currentOrganization)||void 0===n?void 0:n.id)||""}).then((function(t){return t.subscriptions})).then((function(t){return t.sort((function(t,n){return new Date(n.current_period.start_at).getTime()-new Date(t.current_period.start_at).getTime()}))}))]}))}))},a.prototype.checkIsOrganizationFreeSeatsUsedUp=function(){var t;return i(this,void 0,void 0,(function(){var n,e,r,o;return c(this,(function(i){switch(i.label){case 0:return n=(null===(t=this.currentOrganization)||void 0===t?void 0:t.id)||"",e="https://".concat("api.automizely.io","/businesses/v1/organizations/").concat(n,"/seats-usage"),[4,this.sendRequest(e)];case 1:return r=i.sent(),o=r.used_quantity,[2,r.free_quantity<o]}}))}))},a.prototype.fetchAccountsMembership=function(){return i(this,void 0,void 0,(function(){var t,n=this;return c(this,(function(e){return t="https://".concat("bff-api.aftership.io","/business/v1/accounts/me/memberships"),[2,this.sendRequest(t).then((function(t){var e;return n.organizations=t.organizations,n.companies=t.companies,n.membershipFetched=!0,n.accountsMembership=t,null===(e=n.membershipFetchResolver)||void 0===e||e.call(n),n.emit("accountsMembership"),t}))]}))}))},a.prototype.fetchConnections=function(){return i(this,void 0,void 0,(function(){var t,n,e,r=this;return c(this,(function(o){return t=(this.config.appConfig||{}).name,n=void 0===t?"":t,e="https://".concat("api.automizely.io","/businesses/v1/organizations/connections"),[2,this.sendRequest(e,{app_name:n}).then((function(t){var n;return r.connections=t.connections.filter((function(t){return!io.includes(t.app.platform)})),(null===(n=r.config.excludeConnections)||void 0===n?void 0:n.length)&&(r.connections=r.connections.filter((function(t){var n,e=t.app,o=e.name,i=e.platform;return!(null===(n=r.config.excludeConnections)||void 0===n?void 0:n.some((function(t){return t.name===o&&t.platform===i})))}))),r.connectionFetched=!0,r.connections}))]}))}))},a.prototype.fetchLegacyToken=function(){var t;return i(this,void 0,void 0,(function(){var n,e,r,o;return c(this,(function(i){return n=this.config.legacyToken||{},e=n.scope,r=n.audience,o="https://".concat("api.automizely.io","/businesses/v1/organizations/").concat(null===(t=this.currentOrganization)||void 0===t?void 0:t.id,"/legacy-token"),[2,this.sendRequest(o,{scope:e,audience:r}).then((function(t){return t.legacy_token}))]}))}))},a.prototype.fetchBillingOrganization=function(){var t;return i(this,void 0,void 0,(function(){var n;return c(this,(function(e){return n="https://".concat("release-incy-api.automizely.io","/billing/v2/organizations/").concat(null===(t=this.currentOrganization)||void 0===t?void 0:t.id),[2,this.sendRequest(n)]}))}))},a.prototype.sendRequest=function(t,n,r,o,a){return void 0===r&&(r="GET"),void 0===o&&(o=2),void 0===a&&(a={}),i(this,void 0,void 0,(function(){var s,u,l,f=this;return c(this,(function(h){switch(h.label){case 0:return[4,this.getAuthorization()];case 1:return s=h.sent(),u=new URL(t),"GET"===r&&n?Object.entries(n).forEach((function(t){var n=t[0],e=t[1];return u.searchParams.set(n,e)})):n&&(l=JSON.stringify(n)),[2,fetch(u.toString(),{method:r,body:l,headers:e({"Content-Type":"application/json",Authorization:s},a)}).then((function(e){return i(f,void 0,void 0,(function(){var i,a;return c(this,(function(c){switch(c.label){case 0:return e.ok&&e.status<400?[2,e.json().then((function(t){return t.data}))]:"number"!=typeof o||o<=0?[4,e.json()]:[3,2];case 1:throw i=c.sent(),a=new Error(null==i?void 0:i.meta.message),Object.assign(a,i),a;case 2:return 401!==e.status?[3,4]:[4,this.updateKeycloakToken()];case 3:c.sent(),c.label=4;case 4:return[4,Gr(1e3*o)];case 5:return c.sent(),[2,this.sendRequest(t,n,r,o-1)]}}))}))})).catch((function(e){return i(f,void 0,void 0,(function(){return c(this,(function(i){switch(i.label){case 0:if(o<=0||"number"!=typeof o)throw e;return[4,Gr(1e3*o)];case 1:return i.sent(),[2,this.sendRequest(t,n,r,o-1)]}}))}))}))]}}))}))},r([eo,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],a.prototype,"getOrganization",null),r([ro,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],a.prototype,"getCompany",null),a}(Z),ao=function(t){return co.getInstance(t)};return ao.urlCreator=function(t){return i(void 0,void 0,void 0,(function(){var n;return c(this,(function(e){return n=m("".concat("https://accounts.aftership.io/auth","/realms/business")),"logout"===t.action?[2,j(n.logout,{redirect_uri:t.redirectUri||window.location.href})]:[2,U(t,n)]}))}))},ao.getInitializationState=function(){return Boolean(co.authInstance)},ao.getShopifyAppInstance=Y,ao.setShopifyAppInstance=function(t){H=t},setTimeout((function(){return Br("loaded")})),ao}();
//# sourceMappingURL=auth.js.map
